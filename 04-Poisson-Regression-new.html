<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>poisson-regression-new</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="04-Poisson-Regression-new_files/libs/clipboard/clipboard.min.js"></script>
<script src="04-Poisson-Regression-new_files/libs/quarto-html/quarto.js"></script>
<script src="04-Poisson-Regression-new_files/libs/quarto-html/popper.min.js"></script>
<script src="04-Poisson-Regression-new_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="04-Poisson-Regression-new_files/libs/quarto-html/anchor.min.js"></script>
<link href="04-Poisson-Regression-new_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="04-Poisson-Regression-new_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="04-Poisson-Regression-new_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="04-Poisson-Regression-new_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="04-Poisson-Regression-new_files/libs/bootstrap/bootstrap-c0367b04c37547644fece4185067e4a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="04-Poisson-Regression-new_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="04-Poisson-Regression-new_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="sec-poissonreg" class="level1">
<h1>Poisson Regression</h1>
<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h2>
<p>After finishing this chapter, you should be able to:</p>
<ul>
<li>Describe why simple linear regression is not ideal for Poisson data.</li>
<li>Write out a Poisson regression model and identify the assumptions for inference.</li>
<li>Write out the likelihood for a Poisson regression and describe how it could be used to estimate coefficients for a model.</li>
<li>Interpret estimated coefficients from a Poisson regression and construct confidence intervals for them.</li>
<li>Use deviances from Poisson regression models to compare and assess models.</li>
<li>Use an offset to account for varying effort in data collection.</li>
<li>Evaluate when the variance condition may be violated; in those cases, select, fit, and interpret the appropriate alternative model (quasi-Poisson or negative binomial)</li>
<li>Evaluate when zero counts must be modeled differently; in those cases, select, fit, and interpret the appropriate modified Poisson model (zero-inflated Poisson (ZIP) or hurdle).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages required for Chapter 4</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pscl)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="introduction-to-poisson-regression" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-poisson-regression">Introduction to Poisson Regression</h2>
<p>Consider the following questions:</p>
<ol type="1">
<li>Are the number of motorcycle deaths in a given year related to a state’s helmet laws?</li>
<li>Does the number of employers conducting on-campus interviews during a year differ for public and private colleges?</li>
<li>Does the daily number of asthma-related visits to an Emergency Room differ depending on air pollution indices?</li>
<li>Has the number of deformed fish in randomly selected Minnesota lakes been affected by changes in trace minerals in the water over the last decade?</li>
</ol>
<p>Each example involves predicting a response using one or more explanatory variables, although these examples have response variables that are counts per some unit of time or space. A Poisson random variable is often used to model counts; see [Chapter 3: Distribution Theory] for properties of the Poisson distribution. Since a Poisson random variable is a count, its minimum value is zero and, in theory, the maximum is unbounded. We’d like to model our main parameter <span class="math inline">\(\lambda\)</span>, the average number of occurrences per unit of time or space, as a function of one or more covariates. For example, in the first question above, <span class="math inline">\(\lambda_i\)</span> represents the average number of motorcycle deaths in a year for state <span class="math inline">\(i\)</span>, and we hope to show that state-to-state variability in <span class="math inline">\(\lambda_i\)</span> can be explained by state helmet laws.</p>
<p>For a linear least squares regression model, the parameter of interest is the average response, <span class="math inline">\(\mu_i\)</span>, for subject <span class="math inline">\(i\)</span>, and <span class="math inline">\(\mu_i\)</span> is modeled as a line in the case of one explanatory variable. By analogy, it might seem reasonable to try to model the Poisson parameter <span class="math inline">\(\lambda_i\)</span> as a linear function of an explanatory variable, but there are some problems with this approach. In fact, a model like <span class="math inline">\(\lambda_i=\beta_0+\beta_1x_i\)</span> doesn’t work well for Poisson data. A line is certain to yield negative values for certain <span class="math inline">\(x_i\)</span>, but <span class="math inline">\(\lambda_i\)</span> can only take on values from 0 to <span class="math inline">\(\infty\)</span>. In addition, the equal variance assumption in linear regression inference is violated because as the mean rate for a Poisson variable increases, the variance also increases (recall from [Chapter 3: Distribution Theory] that if <span class="math inline">\(Y\)</span> is the observed count, then <span class="math inline">\(E(Y)=Var(Y)=\lambda\)</span>).</p>
<p>One way to avoid these problems is to model log(<span class="math inline">\(\lambda_i\)</span>) instead of <span class="math inline">\(\lambda_i\)</span> as a function of the covariates. The log(<span class="math inline">\(\lambda_i\)</span>) takes on values from <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(\infty\)</span>. We can also take into account the increase in the variance with an increasing mean using this approach. (Note that throughout <em>Beyond Multiple Linear Regression</em> we use log to represent the natural logarithm.) Thus, we will consider the <strong>Poisson regression</strong> model:</p>
<p><span class="math display">\[\begin{equation*}
log(\lambda_i)=\beta_0+\beta_1 x_i
\end{equation*}\]</span> where the observed values <span class="math inline">\(Y_i \sim\)</span> Poisson with <span class="math inline">\(\lambda=\lambda_i\)</span> for a given <span class="math inline">\(x_i\)</span>. For example, each state <span class="math inline">\(i\)</span> can potentially have a different <span class="math inline">\(\lambda\)</span> (average motorcycle deaths per year) depending on its value of <span class="math inline">\(x_i\)</span>, where <span class="math inline">\(x_i\)</span> could represent presence or absence of a particular helmet law. Note that the Poisson regression model contains no separate error term like the <span class="math inline">\(\epsilon\)</span> we see in linear regression, because <span class="math inline">\(\lambda\)</span> determines both the mean and the variance of a Poisson random variable.</p>
<section id="poisson-regression-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="poisson-regression-assumptions">Poisson Regression Assumptions</h3>
<p>Much like linear least squares regression (LLSR), using Poisson regression to make inferences requires model assumptions.</p>
<ol type="1">
<li><strong>Poisson Response</strong> The response variable is a count per unit of time or space, described by a Poisson distribution.</li>
<li><strong>Independence</strong> The observations must be independent of one another.</li>
<li><strong>Mean=Variance</strong> By definition, the mean of a Poisson random variable must be equal to its variance.</li>
<li><strong>Linearity</strong> The log of the mean rate, log(<span class="math inline">\(\lambda\)</span>), must be a linear function of x.</li>
</ol>
</section>
<section id="a-graphical-look-at-poisson-regression" class="level3">
<h3 class="anchored" data-anchor-id="a-graphical-look-at-poisson-regression">A Graphical Look at Poisson Regression</h3>
<div id="fig-OLSpois" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-OLSpois-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-OLSpois" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-OLSpois-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-OLSpois-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-OLSpois-1.png" class="img-fluid figure-img" data-ref-parent="fig-OLSpois" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-OLSpois-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Linear Regression
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-OLSpois" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-OLSpois-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-OLSpois-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-OLSpois-2.png" class="img-fluid figure-img" data-ref-parent="fig-OLSpois" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-OLSpois-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Poisson Regression
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-OLSpois-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Comparison of regression models.
</figcaption>
</figure>
</div>
<p><a href="#fig-OLSpois" class="quarto-xref">Figure&nbsp;1</a> illustrates a comparison of the LLSR model for inference to Poisson regression using a log function of <span class="math inline">\(\lambda\)</span>.</p>
<ol type="1">
<li>The graphic displaying the LLSR inferential model appears in the left panel of <a href="#fig-OLSpois" class="quarto-xref">Figure&nbsp;1</a>. It shows that, for each level of X, the responses are approximately normal. The panel on the right side of <a href="#fig-OLSpois" class="quarto-xref">Figure&nbsp;1</a> depicts what a Poisson regression model looks like. For each level of X, the responses follow a Poisson distribution (Assumption 1). For Poisson regression, small values of <span class="math inline">\(\lambda\)</span> are associated with a distribution that is noticeably skewed with lots of small values and only a few larger ones. As <span class="math inline">\(\lambda\)</span> increases the distribution of the responses begins to look more and more like a normal distribution.</li>
<li>In the LLSR model, the variation in <span class="math inline">\(Y\)</span> at each level of X, <span class="math inline">\(\sigma^2\)</span>, is the same. For Poisson regression the responses at each level of X become more variable with increasing means, where variance=mean (Assumption 3).</li>
<li>In the case of LLSR, the mean responses for each level of X, <span class="math inline">\(\mu_{Y|X}\)</span>, fall on a line. In the case of the Poisson model, the mean values of <span class="math inline">\(Y\)</span> at each level of <span class="math inline">\(X\)</span>, <span class="math inline">\(\lambda_{Y|X}\)</span>, fall on a curve, not a line, although the logs of the means should follow a line (Assumption 4).</li>
</ol>
</section>
</section>
<section id="case-studies-overview" class="level2">
<h2 class="anchored" data-anchor-id="case-studies-overview">Case Studies Overview</h2>
<p>We take a look at the Poisson regression model in the context of four case studies. Each case study is based on real data and real questions. Modeling household size in the Philippines introduces the idea of regression with a Poisson response along with checking assumptions and interpreting estimated model coefficient. A quadratic term is added to a model to determine an optimal size per household, methods of model comparison are introduced, and we see how to account for overdispersion, when actual variability exceeds what is expected by the model. The bald eagles case study introduces the idea of offsets to account for sampling effort. Finally, we consider two case studies in which new models are needed to better account for the number of zeros: the weekend drinking example uses a zero-inflated Poisson (ZIP) model, while the ambiguity in Congressional candidate statements case study uses a hurdle model. These four case studies also provide context for some of the familiar concepts related to modeling such as exploratory data analysis (EDA), estimation, and residual plots.</p>
</section>
<section id="sec-philippines" class="level2">
<h2 class="anchored" data-anchor-id="sec-philippines">Case Study: Household Size in the Philippines</h2>
<p>How many other people live with you in your home? The number of people sharing a house differs from country to country and often from region to region. International agencies use household size when determining needs of populations, and the household sizes determine the magnitude of the household needs.</p>
<p>The Philippine Statistics Authority (PSA) spearheads the Family Income and Expenditure Survey (FIES) nationwide. The survey, which is undertaken every three years, is aimed at providing data on family income and expenditure, including levels of consumption by item of expenditure. Our data, from the 2015 FIES, is a subset of 1500 of the 40,000 observations <span class="citation" data-cites="PSA">[@PSA]</span>. Our data set focuses on five regions: Central Luzon, Metro Manila, Ilocos, Davao, and Visayas (see <a href="#fig-philippinesmap" class="quarto-xref">Figure&nbsp;2</a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-philippinesmap" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-philippinesmap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data/map_of_philippines.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-philippinesmap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Regions of the Philippines.
</figcaption>
</figure>
</div>
</div>
</div>
<p>At what age are heads of households in the Philippines most likely to find the largest number of people in their household? Is this association similar for poorer households (measured by the presence of a roof made from predominantly light/salvaged materials)? We begin by explicitly defining our response, <span class="math inline">\(Y=\)</span> number of household members other than the head of the household. We then define the explanatory variables: age of the head of the household, type of roof (predominantly light/salvaged material or predominantly strong material), and location (Central Luzon, Davao Region, Ilocos Region, Metro Manila, or Visayas). Note that predominantly light/salvaged materials are a combination of light material, mixed but predominantly light material, and mixed but predominantly salvaged material, and salvaged matrial. Our response is a count, so we consider a Poisson regression where the parameter of interest is <span class="math inline">\(\lambda\)</span>, the average number of people, other than the head, per household. We will primarily examine the relationship between household size and age of the head of household, controlling for location and income.</p>
<section id="sec-organizedata4" class="level3">
<h3 class="anchored" data-anchor-id="sec-organizedata4">Data Organization</h3>
<p>The first five rows from our data set <code>phillipines.csv</code> are illustrated in <a href="#tbl-fHH1table1" class="quarto-xref">Table&nbsp;1</a>. Each line of the data file refers to a household at the time of the survey:</p>
<ul>
<li><code>location</code> = where the house is located (Central Luzon, Davao Region, Ilocos Region, Metro Manila, or Visayas)</li>
<li><code>age</code> = the age of the head of household</li>
<li><code>total</code> = the number of people in the household other than the head</li>
<li><code>numLT5</code> = the number in the household under 5 years of age</li>
<li><code>roof</code> = the type of roof in the household (either Predominantly Light/Salvaged Material, or Predominantly Strong Material, where stronger material can sometimes be used as a proxy for greater wealth)</li>
</ul>
<div class="cell">
<div id="tbl-fHH1table1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-fHH1table1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: The first five observations from the Philippines Household case study.
</figcaption>
<div aria-describedby="tbl-fHH1table1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">…1</th>
<th style="text-align: left;">location</th>
<th style="text-align: right;">age</th>
<th style="text-align: right;">total</th>
<th style="text-align: right;">numLT5</th>
<th style="text-align: left;">roof</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">CentralLuzon</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Predominantly Strong Material</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">MetroManila</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Predominantly Strong Material</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">DavaoRegion</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Predominantly Strong Material</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Visayas</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Predominantly Strong Material</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">MetroManila</td>
<td style="text-align: right;">74</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Predominantly Strong Material</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="sec-exploreHH" class="level3">
<h3 class="anchored" data-anchor-id="sec-exploreHH">Exploratory Data Analyses</h3>
<p>For the rest of this case study, we will refer to the number of people in a household as the total number of people in that specific household <em>besides</em> the head of household. The average number of people in a household is 3.68 (Var = 5.53), and there are anywhere from 0 to 16 people in the houses. <a href="#fig-nhouse" class="quarto-xref">Figure&nbsp;3</a> reveals a fair amount of variability in the number in each house; responses range from 0 to 16 with many of the respondents reporting between 1 and 5 people in the house. Like many Poisson distributions, this graph is right skewed. It clearly does not suggest that the number of people in a household is a normally distributed response.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-nhouse" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nhouse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-nhouse-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nhouse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Distribution of household size across all 5 Philippine regions.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In terms of potential explanatory variables for household size, we see that over 11.1% of these households are made from predominantly light and salvaged material. The mean number of people in a house for houses with a roof made from predominantly strong material is 3.69 (Var=5.55), whereas houses with a roof made from predominantly light/salvaged material average 3.64 people (Var=5.41). Out of five regions, Visayas has the largest household size, on average, with a mean of 3.90 in the household, and the Davao Region has the smallest with a mean of 3.39. In <a href="#fig-locationVtotal" class="quarto-xref">Figure&nbsp;4</a>, we see that the Visayas region has the highest concentration of household with 7 or more members, while the Davao region and Central Luzon have the highest concentrations of households with 3-4 members.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-locationVtotal" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-locationVtotal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-locationVtotal-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-locationVtotal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Density plots of household size in 5 Philippine regions.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-totalPoisByAge" class="quarto-xref">Figure&nbsp;5</a> further shows that responses can be reasonably modeled with a Poisson distribution when grouped by a key explanatory variable: age of the household head. These last two plots together suggest that Assumption 1 (Poisson Response) is satisfactory in this case study.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-totalPoisByAge" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-totalPoisByAge-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-totalPoisByAge-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-totalPoisByAge-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Distribution of household sizes by age group of the household head.<br>

</figcaption>
</figure>
</div>
</div>
</div>
<p>For Poisson random variables, the variance of <span class="math inline">\(Y\)</span> (i.e., the square of the standard deviation of <span class="math inline">\(Y\)</span>), is equal to its mean, where <span class="math inline">\(Y\)</span> represents the size of an individual household. As the mean increases, the variance increases. So, if the response is a count and the mean and variance are approximately equal for each group of <span class="math inline">\(X\)</span>, a Poisson regression model may be a good choice. In <a href="#tbl-table1chp4" class="quarto-xref">Table&nbsp;2</a> we display age groups by 5-year increments to check to see if the empirical means and variances of the number in the house are approximately equal for each age group. This provides us one way in which to check the Poisson Assumption 3 (mean = variance).</p>
<div class="cell">
<div id="tbl-table1chp4" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-table1chp4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Compare mean and variance of household size within each age group.
</figcaption>
<div aria-describedby="tbl-table1chp4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Age Groups</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Variance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(15,20]</td>
<td style="text-align: right;">1.666667</td>
<td style="text-align: right;">0.6666667</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">(20,25]</td>
<td style="text-align: right;">2.166667</td>
<td style="text-align: right;">1.5588235</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">(25,30]</td>
<td style="text-align: right;">2.918367</td>
<td style="text-align: right;">1.4098639</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="even">
<td style="text-align: left;">(30,35]</td>
<td style="text-align: right;">3.444444</td>
<td style="text-align: right;">2.1931464</td>
<td style="text-align: right;">108</td>
</tr>
<tr class="odd">
<td style="text-align: left;">(35,40]</td>
<td style="text-align: right;">3.841772</td>
<td style="text-align: right;">3.5735306</td>
<td style="text-align: right;">158</td>
</tr>
<tr class="even">
<td style="text-align: left;">(40,45]</td>
<td style="text-align: right;">4.234286</td>
<td style="text-align: right;">4.4447947</td>
<td style="text-align: right;">175</td>
</tr>
<tr class="odd">
<td style="text-align: left;">(45,50]</td>
<td style="text-align: right;">4.489691</td>
<td style="text-align: right;">6.3962662</td>
<td style="text-align: right;">194</td>
</tr>
<tr class="even">
<td style="text-align: left;">(50,55]</td>
<td style="text-align: right;">4.010638</td>
<td style="text-align: right;">5.2512231</td>
<td style="text-align: right;">188</td>
</tr>
<tr class="odd">
<td style="text-align: left;">(55,60]</td>
<td style="text-align: right;">3.806897</td>
<td style="text-align: right;">6.5318966</td>
<td style="text-align: right;">145</td>
</tr>
<tr class="even">
<td style="text-align: left;">(60,65]</td>
<td style="text-align: right;">3.705882</td>
<td style="text-align: right;">6.1958204</td>
<td style="text-align: right;">153</td>
</tr>
<tr class="odd">
<td style="text-align: left;">(65,70]</td>
<td style="text-align: right;">3.339130</td>
<td style="text-align: right;">7.9980168</td>
<td style="text-align: right;">115</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: right;">2.549738</td>
<td style="text-align: right;">5.5435657</td>
<td style="text-align: right;">191</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>If there is a problem with this assumption, most often we see variances much larger than means. Here, as expected, we see more variability as age increases. However, it appears that the variance is smaller than the mean for lower ages, while the variance is greater than the mean for higher ages. Thus, there is some evidence of a violation of the mean=variance assumption (Assumption 3), although any violations are modest.</p>
<p>The Poisson regression model also implies that log(<span class="math inline">\(\lambda_i\)</span>), not the mean household size <span class="math inline">\(\lambda_i\)</span>, is a linear function of age; i.e., <span class="math inline">\(log(\lambda_i)=\beta_0+\beta_1\textrm{age}_i\)</span>. Therefore, to check the linearity assumption (Assumption 4) for Poisson regression, we would like to plot log(<span class="math inline">\(\lambda_i\)</span>) by age. Unfortunately, <span class="math inline">\(\lambda_i\)</span> is unknown. Our best guess of <span class="math inline">\(\lambda_i\)</span> is the observed mean number in the household for each age (level of <span class="math inline">\(X\)</span>). Because these means are computed for observed data, they are referred to as <strong>empirical</strong> means. Taking the logs of the empirical means and plotting by age provides a way to assess the linearity assumption. The smoothed curve added to <a href="#fig-ageXnhouse" class="quarto-xref">Figure&nbsp;6</a> suggests that there is a curvilinear relationship between age and the log of the mean household size, implying that adding a quadratic term should be considered. If the model <span class="math inline">\(log(\lambda_i)=\beta_0+\beta_1\textrm{age}_i\)</span> were adequate, we would see a linear trend in <a href="#fig-ageXnhouse" class="quarto-xref">Figure&nbsp;6</a>. This finding is consistent with the researchers’ hypothesis that there is an age at which a maximum household size occurs. It is worth noting that we are not modeling the log of the empirical means, rather it is the log of the <em>true</em> rate that is modeled. Looking at empirical means, however, does provide an idea of the form of the relationship between log(<span class="math inline">\(\lambda)\)</span> and <span class="math inline">\(x_i\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ageXnhouse" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ageXnhouse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-ageXnhouse-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ageXnhouse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: The log of the mean household sizes by age of the head of household, with loess smoother.<br>

</figcaption>
</figure>
</div>
</div>
</div>
<p>We can extend <a href="#fig-ageXnhouse" class="quarto-xref">Figure&nbsp;6</a> by fitting separate curves for each region (see <a href="#fig-byregion" class="quarto-xref">Figure&nbsp;7</a>). This allows us to see if the relationship between mean household size and age is consistent across region. In this case, the relationships are pretty similar; if they weren’t, we could consider adding an age-by-region interaction to our eventual Poisson regression model.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-byregion" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-byregion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-byregion-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-byregion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Empirical log of the mean household sizes vs.&nbsp;age of the head of household, with loess smoother by region.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Finally, the independence assumption (Assumption 2) can be assessed using knowledge of the study design and the data collection process. In this case, we do not have enough information to assess the independence assumption with the information we are given. If each household was not selected individually in a random manner, but rather groups of households were selected from different regions with differing customs about living arrangements, the independence assumption would be violated. If this were the case, we could use a multilevel model like those discussed in later chapters with a village term.</p>
</section>
</section>
<section id="sec-PoisInference" class="level2">
<h2 class="anchored" data-anchor-id="sec-PoisInference">Estimation and Inference</h2>
<section id="coefficient-interpretation" class="level3">
<h3 class="anchored" data-anchor-id="coefficient-interpretation">Coefficient Interpretation</h3>
<p>We first consider a model for which log(<span class="math inline">\(\lambda\)</span>) is linear in age. We then will determine whether a model with a quadratic term in age provides a significant improvement based on trends we observed in the exploratory data analysis.</p>
<p>R reports an estimated regression equation for the linear Poisson model as:</p>
<p><span class="math display">\[\begin{equation*}
log(\hat{\lambda}) = 1.55 - 0.0047 \textrm{age}
\end{equation*}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>modela <span class="ot">&lt;-</span> <span class="fu">glm</span>(total <span class="sc">~</span> age, <span class="at">family =</span> poisson, <span class="at">data =</span> fHH1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##                 Estimate   Std. Error   z value      Pr(&gt;|z|)
## (Intercept)  1.549942225 0.0502754106 30.829032 1.070156e-208
## age         -0.004705881 0.0009363388 -5.025832  5.012548e-07</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Residual deviance =  2337.089  on  1498 df 
##  Dispersion parameter =  1</code></pre>
</div>
</div>
<p>How can the coefficient estimates be interpreted in terms of this example? As done when interpreting slopes in the LLSR models, we consider how the estimated mean number in the house, <span class="math inline">\(\lambda\)</span>, changes as the age of the household head increases by an additional year. But in place of looking at change in the mean number in the house, with a Poisson regression we consider the log of the mean number in the house and then convert back to original units. For example, consider a comparison of two models—one for a given age (<span class="math inline">\(x\)</span>) and one after increasing age by 1 (<span class="math inline">\(x+1\)</span>):</p>
<p><span id="eq-rateRatio"><span class="math display">\[
\begin{aligned}
log(\lambda_X) &amp;= \beta_0 + \beta_1X \\
log(\lambda_{X+1}) &amp;= \beta_0 + \beta_1(X+1) \\
log(\lambda_{X+1})-log(\lambda_X) &amp;=  \beta_1 \\
log \left(\frac{\lambda_{X+1}}{\lambda_X}\right)   &amp;= \beta_1\\
\frac{\lambda_{X+1}}{\lambda_X} &amp;= e^{\beta_1}
\end{aligned}
\tag{1}\]</span></span></p>
<p>These results suggest that by exponentiating the coefficient on age we obtain the <em>multiplicative</em> factor by which the mean count changes. In this case, the mean number in the house changes by a factor of <span class="math inline">\(e^{-0.0047}=0.995\)</span> or decreases by 0.5% (since <span class="math inline">\(1-.995 = .005\)</span>) with each additional year older the household head is; or, we predict a 0.47% <em>increase</em> in mean household size for a 1-year <em>decrease</em> in age of the household head (since <span class="math inline">\(1/.995=1.0047\)</span>). The quantity on the left-hand side of <a href="#eq-rateRatio" class="quarto-xref">Equation&nbsp;1</a> is referred to as a <strong>rate ratio</strong> or <strong>relative risk</strong>, and it represents a percent change in the response for a unit change in X. In fact, for regression models in general, whenever a variable (response or explanatory) is logged, we make interpretations about multiplicative effects on that variable, while with unlogged variables we can reach our usual interpretations about additive effects.</p>
</section>
<section id="confidence-intervals" class="level3">
<h3 class="anchored" data-anchor-id="confidence-intervals">Confidence Intervals</h3>
<p>Typically, the standard errors for the estimated coefficients are included in Poisson regression output. Here the standard error for the estimated coefficient for age is 0.00094; we can use the standard error to construct a confidence interval for <span class="math inline">\(\beta_1\)</span>. A <strong>Wald-type (normal theory) 95% confidence interval (CI)</strong> provides a range of plausible values for the <code>age</code> coefficient and can be constructed:</p>
<p><span class="math display">\[
(\hat\beta_1-Z^*\cdot SE(\hat\beta_1), \quad \hat\beta_1+Z^*\cdot SE(\hat\beta_1))
\]</span></p>
<p><span class="math display">\[
(-0.0047-1.96*0.00094, \quad -0.0047+1.96*0.00094)
\]</span></p>
<p><span class="math display">\[
(-0.0065, -0.0029).
\]</span></p>
<p>Exponentiating the endpoints yields a confidence interval for the relative risk; i.e., the percent change in household size for each additional year older. Thus <span class="math inline">\((e^{-0.0065},e^{-0.0029})=(0.993,0.997)\)</span> suggests that we are 95% confident that the mean number in the house decreases between 0.7% (<span class="math inline">\((1 - .993) \times 100\%\)</span>) and 0.3% (<span class="math inline">\((1 - .997) \times 100\%\)</span>) for each additional year older the head of household is. It is best to construct a confidence interval for the coefficient and then exponentiate the endpoints because the estimated coefficients more closely follow a normal distribution than the exponentiated coefficients. There are other approaches to constructing intervals in these circumstances, including profile likelihood, the delta method, and bootstrapping, and we will discuss some of those approaches later. In this case, for instance, the profile likelihood interval is nearly identical to the Wald-type confidence interval above.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Profile likelihood intervals
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The profile likelihood function of a model parameter is obtained by finding the maximum log-likelihood for each fixed value of the parameter of interest across all possible values of other model parameters. Profile likelihood confidence intervals are then based on the asymptotic chi-square distribution of the log likelihood ratio test statistic, rather than the asymptotic normal distribution of the maximum likelihood estimator (MLE) as with Wald-type (normal theory) methods. As a result, profile likelihood methods tend to perform better than Wald-type methods with sparse data or likelihoods that are not symmetric around the MLE.</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CI for betas using profile likelihood</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(modela)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##                    2.5 %       97.5 %
## (Intercept)  1.451170100  1.648249185
## age         -0.006543163 -0.002872717</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(modela))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##                 2.5 %    97.5 %
## (Intercept) 4.2681057 5.1978713
## age         0.9934782 0.9971314</code></pre>
</div>
</div>
</section>
<section id="significance-testing" class="level3">
<h3 class="anchored" data-anchor-id="significance-testing">Significance Testing</h3>
<p>If there is no association between age and household size, there is no change in household size for each additional year, so <span class="math inline">\(\lambda_X\)</span> is equal to <span class="math inline">\(\lambda_{X+1}\)</span> and the ratio <span class="math inline">\(\lambda_{X+1}/\lambda_X\)</span> is 1. In other words, if there is no association between age and household size, then <span class="math inline">\(\beta_1=0\)</span> and <span class="math inline">\(e^{\beta_1}=1\)</span>. Note that our interval for <span class="math inline">\(e^{\beta_1}\)</span>, (0.993,0.997), does not include 1, so the model with age is preferred to a model without age; i.e., age is significantly associated with household size. Note that we could have similarly confirmed that our confidence interval for <span class="math inline">\(\beta_1\)</span> does not include 0 to show the significance of age as a predictor of household size.</p>
<section id="wald-type-test" class="level4">
<h4 class="anchored" data-anchor-id="wald-type-test">Wald-type Test</h4>
<p>Another way to test the significance of the age term is to calculate a <strong>Wald-type statistic</strong>. A Wald-type test statistic is the estimated coefficient divided by its standard error. When the true coefficient is 0, this test statistic follows a standard normal distribution for sufficiently large <span class="math inline">\(n\)</span>. The estimated coefficient associated with the linear term in age is <span class="math inline">\({\hat{\beta}_1}=-0.0047\)</span> with standard error <span class="math inline">\(SE(\hat{\beta}_1)=0.00094\)</span>. The value for the Wald test statistic is then <span class="math inline">\(Z=\hat{\beta}_1/SE(\hat{\beta}_1)=-5.026\)</span>, where <span class="math inline">\(Z\)</span> follows a standard normal distribution if <span class="math inline">\(\beta_1=0\)</span>. In this case, the two-sided p-value based on the standard normal distribution for testing <span class="math inline">\(H_0:\beta_1=0\)</span> is almost 0 (<span class="math inline">\(p=0.000000501\)</span>). Therefore, we have statistically significant evidence (Z = -5.026, p &lt; .001) that average household size decreases as age of the head of household increases.</p>
</section>
<section id="sec-Devtocompare" class="level4">
<h4 class="anchored" data-anchor-id="sec-Devtocompare">Using Deviances to Compare Models</h4>
<p>There is another way in which to assess how useful age is in our model. A <strong>deviance</strong> is a way in which to measure how the observed data deviates from the model predictions; it will be defined more precisely in <a href="#sec-PoisResid" class="quarto-xref">Section&nbsp;1.7.4</a>, but it is similar to sum of squared errors (unexplained variability in the response) in LLSR regression. Because we want models that minimize deviance, we calculate the <strong>drop-in-deviance</strong> when adding age to the model with no covariates (the <strong>null model</strong>). The deviances for the null model and the model with age can be found in the model output. A residual deviance for the model with age is reported as 2337.1 with 1498 df. The output also includes the deviance and degrees of freedom for the null model (2362.5 with 1499 df). The drop-in-deviance is 25.4 (2362.5 - 2337.1) with a difference of only 1 df, so that the addition of one extra term (age) reduced unexplained variability by 25.4. If the null model were true, we would expect the drop-in-deviance to follow a <span class="math inline">\(\chi^2\)</span> distribution with 1 df. Therefore, the p-value for comparing the null model to the model with age is found by determining the probability that the value for a <span class="math inline">\(\chi^2\)</span> random variable with one degree of freedom exceeds 25.4, which is essentially 0. Once again, we can conclude that we have statistically significant evidence (<span class="math inline">\(\chi^2_{\text{df} =1}=25.4\)</span>, <span class="math inline">\(p &lt; .001\)</span>) that average household size decreases as age of the head of household increases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model0 is the null/reduced model</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>model0 <span class="ot">&lt;-</span> <span class="fu">glm</span>(total <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family =</span> poisson, <span class="at">data =</span> fHH1)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>drop_in_dev <span class="ot">&lt;-</span> <span class="fu">anova</span>(model0, modela, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##   ResidDF ResidDev Deviance Df         pval
## 1    1499 2362.488       NA NA           NA
## 2    1498 2337.089 25.39907  1 4.661424e-07</code></pre>
</div>
</div>
<p>More formally, we are testing:</p>
<p><span class="math display">\[\textrm{Null (reduced) Model}: \log(\lambda) = \beta_0 \textrm{ or } \beta_1=0\]</span> <span class="math display">\[\textrm{Larger (full) Model}: \log(\lambda) = \beta_0 + \beta_1\textrm{age} \textrm{ or } \beta_1 \neq 0 \]</span></p>
<p>In order to use the drop-in-deviance test, the models being compared must be <strong>nested</strong>; e.g., all the terms in the smaller model must appear in the larger model. Here the smaller model is the null model with the single term <span class="math inline">\(\beta_0\)</span> and the larger model has <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>, so the two models are indeed nested. For nested models, we can compare the models’ residual deviances to determine whether the larger model provides a significant improvement.</p>
</section>
<section id="summary" class="level4">
<h4 class="anchored" data-anchor-id="summary">Summary</h4>
<p>Here, then, is a summary of these two approaches to hypothesis testing about terms in Poisson regression models:</p>
<p align="center">
<strong>Drop-in-deviance test to compare models</strong>
</p>
<ul>
<li>Compute the deviance for each model, then calculate: drop-in-deviance = residual deviance for reduced model – residual deviance for the larger model.</li>
<li>When the reduced model is true, the drop-in-deviance <span class="math inline">\(\sim \chi^2_d\)</span> where d= the difference in the degrees of freedom associated with the two models (that is, the difference in the number of terms/coefficients).</li>
<li>A large drop-in-deviance favors the larger model.</li>
</ul>
<p align="center">
<strong>Wald test for a single coefficient</strong>
</p>
<ul>
<li>Wald-type statistic = estimated coefficient / standard error</li>
<li>When the true coefficient is 0, for sufficiently large <span class="math inline">\(n\)</span>, the test statistic <span class="math inline">\(\sim\)</span> N(0,1).</li>
<li>If the magnitude of the test statistic is large, there is evidence that the true coefficient is not 0.</li>
</ul>
<p>The drop-in-deviance and the Wald-type tests usually provide consistent results; however, if there is a discrepancy, the drop-in-deviance is preferred. Not only does the drop-in-deviance test perform better in more cases, but it’s also more flexible. If two models differ by one term, then the drop-in-deviance test essentially tests if a single coefficient is 0 like the Wald test does, while if two models differ by more than one term, the Wald test is no longer appropriate. And if one model is not nested in the other, we can compare measures of model performance such as AIC and BIC (see Chapter 2: Beyond Least Squares), although no formal significance test is available.</p>
</section>
</section>
<section id="sec-likelihood" class="level3">
<h3 class="anchored" data-anchor-id="sec-likelihood">Using Likelihoods to Fit Models (optional)</h3>
<p>Before continuing with model building, we take a short detour to see how coefficient estimates are determined in a Poisson regression model. The least squares approach requires a linear relationship between the parameter, <span class="math inline">\(\lambda_i\)</span> (the expected or mean response for observation <span class="math inline">\(i\)</span>), and <span class="math inline">\(x_i\)</span> (the age for observation <span class="math inline">\(i\)</span>). However, it is log<span class="math inline">\((\lambda_i)\)</span>, not <span class="math inline">\(\lambda_i\)</span>, that is linearly related to X with the Poisson model. The assumptions of equal variance and normality also do not hold for Poisson regression. Thus, the method of least squares will not be helpful for inference in Poisson regression. Instead of least squares, we employ the likelihood principle to find estimates of our model coefficients, as in Chapter 2: Beyond Least Squares. We look for those coefficient estimates for which the likelihood of our data is maximized; these are the <strong>maximum likelihood estimates</strong>. </p>
<p>The likelihood for n <em>independent</em> observations is the product of the probabilities. For example, if we observe five households with household sizes of 4, 2, 8, 6, and 1 person beyond the head, the likelihood is:</p>
<p><span class="math display">\[ Likelihood = P(Y_1=4)*P(Y_2=2)*P(Y_3=8)*P(Y_4=6)*P(Y_5=1)\]</span> Recall that the probability of a Poisson response can be written</p>
<p><span class="math display">\[P(Y=y)=\frac{e^{-\lambda}\lambda^y}{y!}\]</span> for <span class="math inline">\(y = 0, 1, 2, ...\)</span> So, the likelihood can be written as</p>
<p><span class="math display">\[\begin{align*}
Likelihood&amp;= \frac{ e^{-\lambda_1}\lambda_1^4 }{ 4! }*
\frac{ e^{-\lambda_2}\lambda_2^2 }{ 2! } *\frac{e^{-\lambda_3}\lambda_3^8}{8!}*
\frac{e^{-\lambda_4}\lambda_4^6}{6!}*\frac{e^{-\lambda_5}\lambda_5^1}{1!}
\end{align*}\]</span> where each <span class="math inline">\(\lambda_i\)</span> can differ for each household depending on a particular <span class="math inline">\(x_i\)</span>. As in [Chapter 2: Beyond Least Squares], it will be easier to find a maximum if we take the log of the likelihood and ignore the constant term resulting from the sum of the factorials:</p>
<p><span id="eq-poisLoglik"><span class="math display">\[
\begin{aligned}
-logL&amp; \propto \lambda_{1}-4log(\lambda_{1})+\lambda_{2}-2log(\lambda_{2}) \nonumber \\
&amp; +\lambda_{3}-8log(\lambda_{3})+\lambda_{4}-6log(\lambda_{4}) \nonumber \\
&amp; +\lambda_{5}-log(\lambda_{5})
\end{aligned}
\tag{2}\]</span></span></p>
<p>Now if we had the age of the head of the household for each house (<span class="math inline">\(x_i\)</span>), we consider the Poisson regression model:</p>
<p><span class="math display">\[log(\lambda_i)=\beta_0+\beta_1x_i \]</span></p>
<p>This implies that <span class="math inline">\(\lambda\)</span> differs for each age and can be determined using</p>
<p><span class="math display">\[\lambda_i=e^{\beta_0+\beta_1x_i.}\]</span></p>
<p>If the ages are 32, 21, 55, 44, and 28 years, respecively, our log-likelihood can be written:</p>
<p><span id="eq-poisLoglik2"><span class="math display">\[
\begin{aligned}
logL \propto &amp; [-e^{\beta_0+\beta_132}+4({\beta_0+\beta_132})]+
[-e^{\beta_0+\beta_121}+2({\beta_0+\beta_121})]+ \nonumber \\
&amp;  [-e^{\beta_0+\beta_155}+8({\beta_0+\beta_155})]+
[-e^{\beta_0+\beta_144}+6({\beta_0+\beta_144})]+ \nonumber \\
  &amp;  [-e^{\beta_0+\beta_128}+({\beta_0+\beta_128})]
\end{aligned}
\tag{3}\]</span></span></p>
<p>To see this, match the terms in <a href="#eq-poisLoglik" class="quarto-xref">Equation&nbsp;2</a> with those in <a href="#eq-poisLoglik2" class="quarto-xref">Equation&nbsp;3</a>, noting that <span class="math inline">\(\lambda_i\)</span> has been replaced with <span class="math inline">\(e^{\beta_0+\beta_1x_i}\)</span>. It is <a href="#eq-poisLoglik2" class="quarto-xref">Equation&nbsp;3</a> that will be used to estimate the coefficients <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>. Although this looks a little more complicated than the log-likelihoods we saw in [Chapter 2: Beyond Least Squares], the fundamental ideas are the same. In theory, we try out different possible values of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> until we find the two for which the log-likelihood is largest. Most statistical software packages have automated search algorithms to find those values for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> that maximize the log-likelihood.</p>
</section>
</section>
<section id="linear-least-squares-vs.-poisson-regression" class="level2">
<h2 class="anchored" data-anchor-id="linear-least-squares-vs.-poisson-regression">Linear Least Squares vs.&nbsp;Poisson Regression </h2>
<p><span class="math display">\[\begin{gather*}
\underline{\textrm{Response}} \\
\mathbf{LLSR:}\textrm{ Normal} \\
\mathbf{Poisson Regression:}\textrm{ Counts} \\
\textrm{ } \\
\underline{\textrm{Variance}} \\
\mathbf{LLSR:}\textrm{ Equal for each level of X} \\
\mathbf{Poisson Regression:}\textrm{ Equal to the mean for each level of X} \\
\textrm{ } \\
\underline{\textrm{Model Fitting}} \\
\mathbf{LLSR:}\ \mu=\beta_0+\beta_1x \textrm{ using Least Squares}\\
\mathbf{Poisson Regression:}\ log(\lambda)=\beta_0+\beta_1x \textrm{ using Maximum Likelihood}\\
\end{gather*}\]</span></p>
<p><span class="math display">\[\begin{gather*}
\underline{\textrm{EDA}} \\
\mathbf{LLSR:}\textrm{ Plot X vs. Y; add line} \\
\mathbf{Poisson Regression:}\textrm{ Find }log(\bar{y})\textrm{ for several subgroups; plot vs. X} \\
\textrm{ } \\
\underline{\textrm{Comparing Models}} \\
\mathbf{LLSR:}\textrm{ Extra sum of squares F-tests; AIC/BIC} \\
\mathbf{Poisson Regression:}\textrm{ Drop in Deviance tests; AIC/BIC} \\
\textrm{ } \\
\underline{\textrm{Interpreting Coefficients}} \\
\mathbf{LLSR:}\ \beta_1=\textrm{ change in }\mu_y\textrm{ for unit change in X} \\
\mathbf{Poisson Regression:}\ e^{\beta_1}=\textrm{ percent change in }\lambda\textrm{ for unit change in X}
\end{gather*}\]</span></p>
</section>
<section id="model-building" class="level2">
<h2 class="anchored" data-anchor-id="model-building">Model Building</h2>
<section id="sec-2ndorder-hhsize" class="level3">
<h3 class="anchored" data-anchor-id="sec-2ndorder-hhsize">Second Order Model</h3>
<p>In <a href="#sec-Devtocompare" class="quarto-xref">Section&nbsp;1.5.3.2</a>, the Wald-type test and drop-in-deviance test both suggest that a linear term in age is useful. But our exploratory data analysis in <a href="#sec-exploreHH" class="quarto-xref">Section&nbsp;1.4.2</a> suggests that a quadratic model might be more appropriate. A quadratic model would allow us to see if there exists an age where the number in the house is, on average, a maximum. The output for a quadratic model appears below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fHH1 <span class="ot">&lt;-</span> fHH1 <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">age2 =</span> age<span class="sc">*</span>age)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>modela2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(total <span class="sc">~</span> age <span class="sc">+</span> age2, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> poisson, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> fHH1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##                  Estimate   Std. Error    z value     Pr(&gt;|z|)
## (Intercept) -0.3325296333 1.788357e-01  -1.859414 6.296847e-02
## age          0.0708867627 6.890442e-03  10.287694 8.007069e-25
## age2        -0.0007083289 6.405674e-05 -11.057834 2.008898e-28</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Residual deviance =  2200.944  on  1497 df 
##  Dispersion parameter =  1</code></pre>
</div>
</div>
<p>We can assess the importance of the quadratic term in two ways. First, the p-value for the Wald-type statistic for age<span class="math inline">\(^2\)</span> is statistically significant (Z = -11.058, p &lt; 0.001). Another approach is to perform a drop-in-deviance test.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>drop_in_dev <span class="ot">&lt;-</span> <span class="fu">anova</span>(modela, modela2, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##   ResidDF ResidDev Deviance Df         pval
## 1    1498 2337.089       NA NA           NA
## 2    1497 2200.944 136.1454  1 1.854452e-31</code></pre>
</div>
</div>
<p><span class="math inline">\(H_0:\)</span> log(<span class="math inline">\(\lambda\)</span>)=<span class="math inline">\(\beta_0+\beta_1 \textrm{age}\)</span> (reduced model)</p>
<p><span class="math inline">\(H_A:\)</span> log(<span class="math inline">\(\lambda\)</span>)=<span class="math inline">\(\beta_0+\beta_1 \textrm{age} + \beta_2 \textrm{age}^2\)</span> (larger model)</p>
<p>The first order model has a residual deviance of 2337.1 with 1498 df and the second order model, the quadratic model, has a residual deviance of 2200.9 with 1497 df. The drop-in-deviance by adding the quadratic term to the linear model is 2337.1 - 2200.9 = 136.2 which can be compared to a <span class="math inline">\(\chi^2\)</span> distribution with one degree of freedom. The p-value is essentially 0, so the observed drop of 136.2 again provides significant support for including the quadratic term.</p>
<p>We now have an equation in age which yields the estimated log(mean number in the house).</p>
<p><span class="math display">\[\textrm{log(mean numHouse)} =  -0.333 + 0.071 \textrm{age} - 0.00071 \textrm{age}^2\]</span></p>
<p>As shown in the following, with calculus we can determine that the maximum estimated additional number in the house is <span class="math inline">\(e^{1.441} = 4.225\)</span> (on average) when the head of the household is 50.04 years old.</p>
<p><span class="math display">\[\begin{align*}
\textrm{log(total)} &amp; = -0.333 + 0.071\textrm{age} - 0.00071 \textrm{age}^2 \\
\frac{d}{d\textrm{age}}\textrm{log(total)} &amp; = 0 + 0.071 - 0.0014 \textrm{age} = 0 \\
\textrm{age} &amp; = 50.04 \\
\textrm{max[log(total)]} &amp; = -0.333 + 0.071 \times 50.04 - 0.00071 \times (50.04)^2 = 1.441
\end{align*}\]</span></p>
</section>
<section id="sec-addcov-hhsize" class="level3">
<h3 class="anchored" data-anchor-id="sec-addcov-hhsize">Adding Covariates</h3>
<p>We should consider other covariates that may be related to household size. By controlling for important covariates, we can obtain more precise estimates of the relationship between age and household size. In addition, we may discover that the relationship between age and household size differs by levels of a covariate. One important covariate to consider is location. As described earlier in the case study, there are 5 different regions that are associated with the <code>Location</code> variable: Central Luzon, Metro Manila, Visayas, Davao Region, and Ilocos Region. Assessing the utility of including the covariate <code>Location</code> is, in essence, comparing two nested models; here the quadratic model is compared to the quadratic model plus terms for <code>Location</code>. Results from the fitted model appears below; note that Central Luzon is the reference region that all other regions are compared to since it comes first alphabetically.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>modela2L <span class="ot">&lt;-</span> <span class="fu">glm</span>(total <span class="sc">~</span> age <span class="sc">+</span> age2 <span class="sc">+</span> location, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> poisson, </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> fHH1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##                           Estimate   Std. Error     z value     Pr(&gt;|z|)
## (Intercept)          -0.3843337714 1.820919e-01  -2.1106581 3.480171e-02
## age                   0.0703628330 6.905067e-03  10.1900292 2.196983e-24
## age2                 -0.0007025856 6.420019e-05 -10.9436677 7.125764e-28
## locationMetroManila   0.0544800704 4.720116e-02   1.1542104 2.484139e-01
## locationDavaoRegion  -0.0193872310 5.378273e-02  -0.3604732 7.184933e-01
## locationVisayas       0.1121091959 4.174960e-02   2.6852758 7.246998e-03
## locationIlocosRegion  0.0609819668 5.265981e-02   1.1580362 2.468493e-01</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Residual deviance =  2187.8  on  1493 df 
##  Dispersion parameter =  1</code></pre>
</div>
</div>
<p>Our Poisson regression model now looks like:</p>
<p><span class="math display">\[\begin{align*}
\textrm{log(total)} = &amp; -0.384 + 0.070 \cdot \textrm{age} - 0.00070 \cdot \textrm{age}^2 +0.061 \cdot \textrm{IlocosRegion} + \\
&amp; 0.054 \cdot\textrm{MetroManila}  +0.112 \cdot\textrm{Visayas} - 0.019 \cdot \textrm{DavaoRegion}
\end{align*}\]</span> Notice that because there are 5 different locations, we must represent the effects of different locations through 4 indicator variables. For example, <span class="math inline">\(\hat{\beta}_6=-0.0194\)</span> indicates that, after controlling for the age of the head of household, the log mean household size is 0.0194 lower for households in the Davao Region than for households in the reference location of Central Luzon. In more interpretable terms, mean household size is <span class="math inline">\(e^{-0.0194}=0.98\)</span> times “higher” (i.e., 2% lower) in the Davao Region than in Central Luzon, when holding age constant. Notice also that the coefficients for <span class="math inline">\(\textrm{age}\)</span> and <span class="math inline">\(\textrm{age}^2\)</span> are essentially unchanged from our model without location in <a href="#sec-2ndorder-hhsize" class="quarto-xref">Section&nbsp;1.7.1</a>, so that the maximum estimated additional number in the house is still when the head of the household is around 50 years old, even after adjusting for location.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>drop_in_dev <span class="ot">&lt;-</span> <span class="fu">anova</span>(modela2, modela2L, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##   ResidDF ResidDev Deviance Df       pval
## 1    1497 2200.944       NA NA         NA
## 2    1493 2187.800 13.14369  4 0.01059463</code></pre>
</div>
</div>
<p>To test if the mean household size significantly differs by location, we must use a drop-in-deviance test, rather than a Wald-type test, because four terms (instead of just one) are added when including the <code>location</code> variable. From the Analysis of Deviance table above, adding the four terms corresponding to location to the quadratic model with age produces a statistically significant improvement <span class="math inline">\((\chi^2=13.144, df = 4, p=0.0106)\)</span>, so there is significant evidence that mean household size differs by location, after controlling for age of the head of household. Further modeling (not shown) shows that after controlling for location and age of the head of household, mean household size did not differ between the two types of roofing material.</p>
</section>
<section id="sec-tukeyHSD" class="level3">
<h3 class="anchored" data-anchor-id="sec-tukeyHSD">Tukey’s Honestly Significant Differences</h3>
<p>Comparisons to regions other than the Central Luzon can be accomplished by changing the reference region. If many comparisons are made, it would be best to adjust for multiple comparisons using a method such as <strong>Tukey’s Honestly Significant Differences (HSD)</strong>, which considers all pairwise comparisons among regions. This method helps control the large number of false positives that we would see if we ran multiple t-tests comparing groups. The honestly significant difference compares a standardized mean difference between two groups to a critical value from a studentized range distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>mult_comp <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">glht</span>(modela2L, <span class="fu">mcp</span>(<span class="at">location =</span> <span class="st">"Tukey"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   comparison                  estimate     SE z_value p_value
   &lt;chr&gt;                          &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 MetroManila - CentralLuzon   0.0545  0.0472   1.15   0.772 
 2 DavaoRegion - CentralLuzon  -0.0194  0.0538  -0.360  0.996 
 3 Visayas - CentralLuzon       0.112   0.0417   2.69   0.0542
 4 IlocosRegion - CentralLuzon  0.0610  0.0527   1.16   0.770 
 5 DavaoRegion - MetroManila   -0.0739  0.0499  -1.48   0.567 
 6 Visayas - MetroManila        0.0576  0.0365   1.58   0.504 
 7 IlocosRegion - MetroManila   0.00650 0.0487   0.133  1.00  
 8 Visayas - DavaoRegion        0.131   0.0448   2.94   0.0266
 9 IlocosRegion - DavaoRegion   0.0804  0.0551   1.46   0.582 
10 IlocosRegion - Visayas      -0.0511  0.0435  -1.18   0.760 </code></pre>
</div>
</div>
<p>In our case, Tukey’s Honestly Significant Differences simultaneously evaluates all 10 mean differences between pairs of regions. We find that the only statistically significant difference between regions is that Visayas has a higher mean household size than the Davao Region (<span class="math inline">\(Z = 2.94\)</span> with adjusted <span class="math inline">\(p = .0266\)</span>), although the difference between Visayas and Central Luzon is marginally significant (<span class="math inline">\(Z = 2.69\)</span> with adjusted <span class="math inline">\(p = .0542\)</span>). Mean household size is <span class="math inline">\(e^{0.131} = 14.0\%\)</span> higher in Visayas than in the Davao Region, after controlling for the age of the household head. Based on our HSD analysis, we will later consider modeling location as simply an indicator variable for the Visayas region vs.&nbsp;all others combined.</p>
</section>
<section id="sec-PoisResid" class="level3">
<h3 class="anchored" data-anchor-id="sec-PoisResid">Residuals for Poisson Models (optional)</h3>
<p>Residual plots may provide some insight into Poisson regression models, especially linearity and outliers, although the plots are not quite as useful here as they are for linear least squares regression. There are a few options for computing residuals and predicted values. Residuals may have the form of residuals for LLSR models or the form of deviance residuals which, when squared, sum to the total deviance for the model. Predicted values can be estimates of the counts, <span class="math inline">\(e^{\beta_0+\beta_1X}\)</span>, or log counts, <span class="math inline">\(\beta_0+\beta_1X\)</span>. We will typically use the deviance residuals and predicted counts.</p>
<p>The residuals for linear least squares regression have the form:</p>
<p><span id="eq-OLSresid"><span class="math display">\[
\begin{aligned}
\textrm{LLSR residual}_i  &amp;= \textrm{obs}_i - \textrm{fit}_i \nonumber \\
&amp;={Y_i-\hat{\mu}_i} \nonumber \\
&amp;= Y_i-(\hat{\beta}_0 +\hat{\beta}_1 X_i)
\end{aligned}
\tag{4}\]</span></span></p>
<p>Residual sum of squares (RSS) are formed by squaring and adding these residuals, and we generally seek to minimize RSS in model building. We have several options for creating residuals for Poisson regression models. One is to create residuals in much the same way as we do in LLSR. For Poisson residuals, the predicted values are denoted by <span class="math inline">\(\hat{\lambda}_i\)</span> (in place of <span class="math inline">\(\hat{\mu}_i\)</span> in <a href="#eq-OLSresid" class="quarto-xref">Equation&nbsp;4</a>); they are then standardized by dividing by the standard error, <span class="math inline">\(\sqrt{\hat{\lambda}_i}\)</span>. These kinds of residuals are referred to as <strong>Pearson residuals</strong>. </p>
<p><span class="math display">\[\begin{equation*}
\textrm{Pearson residual}_i = \frac{Y_i-\hat{\lambda}_i}{\sqrt{\hat{\lambda}_i}}
\end{equation*}\]</span></p>
<p>Pearson residuals have the advantage that you are probably familiar with their meaning and the kinds of values you would expect. For example, after standardizing we expect most Pearson residuals to fall between -2 and 2. However, <strong>deviance residuals</strong> have some useful properties that make them a better choice for Poisson regression.</p>
<p>First, we define a <strong>deviance residual</strong> for an observation from a Poisson regression:</p>
<p><span class="math display">\[\begin{equation*}
\textrm{deviance residual}_i = \textrm{sign}(Y_i-\hat{\lambda}_i)
\sqrt{
2 \left[Y_i log\left(\frac{Y_i}{\hat{\lambda}_i}\right)
-(Y_i - \hat{\lambda}_i) \right]}
\end{equation*}\]</span> where <span class="math inline">\(\textrm{sign}(x)\)</span> is defined such that:</p>
<p><span class="math display">\[ \textrm{sign}(x) = \begin{cases} 1  &amp; \textrm{if }\ x &gt; 0 \\
                                    -1 &amp; \textrm{if }\ x &lt; 0  \\
                                    0  &amp; \textrm{if }\ x = 0\end{cases}\]</span></p>
<p>As its name implies, a deviance residual describes how the observed data deviates from the fitted model. Squaring and summing the deviances for all observations produces the <strong>residual deviance</strong> <span class="math inline">\(=\sum (\textrm{deviance residual})^2_i\)</span>. Relatively speaking, observations for good fitting models will have small deviances; that is, the predicted values will deviate little from the observed. However, you can see that the deviance for an observation does not easily translate to a difference in observed and predicted responses as is the case with LLSR models.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Unfortunate names
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If you are slightly amazed and confused that statisticians would use the term “residual deviance” for the sum of a bunch of “deviance residuals”, we share your exasperation! Who does that?! But since those are the most likely terms you’ll see for those two ideas, we will continue to use those confusing monikers.</p>
</div>
</div>
</div>
<p>A careful inspection of the deviance formula reveals several places where the deviance compares <span class="math inline">\(Y\)</span> to <span class="math inline">\(\hat{\lambda}\)</span>: the sign of the deviance is based on the difference between <span class="math inline">\(Y\)</span> and <span class="math inline">\(\hat{\lambda}\)</span>, and under the radical sign we see the ratio <span class="math inline">\(Y/\hat{\lambda}\)</span> and the difference <span class="math inline">\(Y -\hat{\lambda}\)</span>. When <span class="math inline">\(Y = \hat{\lambda}\)</span>, that is, when the model fits perfectly, the difference will be 0 and the ratio will be 1 (so that its log will be 0). So like the residuals in LLSR, an observation that fits perfectly will not contribute to the sum of the squared deviances. This definition of a deviance depends on the likelihood for Poisson models. Other models will have different forms for the deviance depending on their likelihood.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-resid1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-resid1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-resid1-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-resid1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Residual plot for the Poisson model of household size by age of the household head.<br>

</figcaption>
</figure>
</div>
</div>
</div>
<p>A plot (<a href="#fig-resid1" class="quarto-xref">Figure&nbsp;8</a>) of the deviance residuals versus predicted responses for the first order model exhibits curvature, supporting the idea that the model may improved by adding a quadratic term. Other details related to residual plots can be found in a variety of sources including <span class="citation" data-cites="McCullagh1989">@McCullagh1989</span>.</p>
</section>
<section id="sec-PoisGOF" class="level3">
<h3 class="anchored" data-anchor-id="sec-PoisGOF">Goodness-of-Fit</h3>
<p>The model residual deviance can be used to assess the degree to which the predicted values differ from the observed using a <strong>goodness-of-fit test</strong> . When a model is true, we can expect the residual deviance to be distributed as a <span class="math inline">\(\chi^2\)</span> random variable with degrees of freedom equal to the model’s residual degrees of freedom. Our model thus far, the quadratic terms for age plus the indicators for location, has a residual deviance of 2187.8 with 1493 df. The probability of observing a deviance this large if the model fits is essentially 0, saying that there is significant evidence of lack-of-fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(modela2L<span class="sc">$</span>deviance, modela2L<span class="sc">$</span>df.residual)  <span class="co"># GOF test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0</code></pre>
</div>
</div>
<p>There are several reasons why <strong>lack-of-fit</strong> may be observed:</p>
<ul>
<li>We may be missing important covariates or interactions. An expanded model using existing variables or a more comprehensive data set featuring new variables may be needed.</li>
<li>There may be extreme observations that cause the deviance to be larger than expected. These extreme observations can often be identified in residual plots.</li>
<li>There may be a problem with the Poisson model. In particular, the Poisson model has only a single parameter, <span class="math inline">\(\lambda\)</span>, for each combination of the levels of the predictors which must describe both the mean and the variance.</li>
</ul>
<p>In particular, issues with the Poisson model (the 3rd issue above) can become manifest when the variances in the response are larger than the corresponding means at different levels of the predictors. In that case, the response is more variable than the Poisson model would imply, and the response is considered to be <strong>overdispersed</strong>. In the absence of other covariates or extreme observations for our Philippine household size model, we will consider overdispersion as a possible explanation of the significant lack-of-fit in the next section.</p>
</section>
</section>
<section id="sec-overdispPois" class="level2">
<h2 class="anchored" data-anchor-id="sec-overdispPois">Overdispersion</h2>
<section id="quasi-poisson-models" class="level3">
<h3 class="anchored" data-anchor-id="quasi-poisson-models">Quasi-Poisson Models</h3>
<p><strong>Overdispersion</strong> suggests that there is more variation in the response than the model implies. Under a Poisson model, we would expect the means and variances of the response to be about the same in various groups. Without adjusting for overdispersion, we use incorrect, artificially small standard errors leading to artificially small p-values for model coefficients. We may also end up with artificially complex models.</p>
<p>We can take overdispersion into account in several different ways. The simplest is to use an estimated dispersion factor to inflate standard errors. Another way is to use a negative-binomial regression model. We begin with using an estimate of the dispersion parameter.</p>
<p>We can estimate a dispersion parameter, <span class="math inline">\(\phi\)</span>, by dividing the model deviance by its corresponding degrees of freedom; i.e., <span class="math inline">\(\hat\phi=\frac{\sum(\textrm{Pearson residuals})^2}{n-p}\)</span> where <span class="math inline">\(p\)</span> is the number of model parameters. It follows from what we know about the <span class="math inline">\(\chi^2\)</span> distribution that if there is no overdispersion, this estimate should be close to one. It will be larger than one in the presence of overdispersion. We inflate the standard errors by multiplying the variance by <span class="math inline">\(\phi\)</span>, so that the standard errors are larger than the likelihood approach would imply; i.e., <span class="math inline">\(SE_Q(\hat\beta)=\sqrt{\hat\phi}*SE(\hat\beta)\)</span>, where <span class="math inline">\(Q\)</span> stands for “quasi-Poisson” since multiplying variances by <span class="math inline">\(\phi\)</span> is an ad-hoc solution. Our process for model building and comparison is called <strong>quasi-likelihood</strong>—similar to likelihood but without exact underlying distributions. If we choose to use a dispersion parameter with our model, we refer to the approach as quasi-likelihood. The following output illustrates a quasi-Poisson approach to our age-location model for household size:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>modela2L_quasi <span class="ot">&lt;-</span> <span class="fu">glm</span>(total <span class="sc">~</span> age <span class="sc">+</span> age2 <span class="sc">+</span> location,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> quasipoisson, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> fHH1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##                           Estimate   Std. Error    t value     Pr(&gt;|t|)
## (Intercept)          -0.3843337714 0.2166025174 -1.7743735 7.620514e-02
## age                   0.0703628330 0.0082137357  8.5664837 2.616622e-17
## age2                 -0.0007025856 0.0000763676 -9.2000473 1.168513e-19
## locationMetroManila   0.0544800704 0.0561468673  0.9703136 3.320474e-01
## locationDavaoRegion  -0.0193872310 0.0639757901 -0.3030401 7.619015e-01
## locationVisayas       0.1121091959 0.0496621109  2.2574392 2.412461e-02
## locationIlocosRegion  0.0609819668 0.0626400545  0.9735299 3.304477e-01</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Residual deviance =  2187.8  on  1493 df 
##  Dispersion parameter =  1.414965</code></pre>
</div>
</div>
<p>In the absence of overdispersion, we expect the dispersion parameter estimate to be 1.0. The estimated dispersion parameter here is larger than 1.0 (1.415) indicating overdispersion (extra variance) that should be accounted for. The larger estimated standard errors in the quasi-Poisson model reflect the adjustment. For example, the standard error for the Visayas region term from a likelihood based approach is 0.0417, whereas the quasi-likelihood standard error is <span class="math inline">\(\sqrt{1.415}*0.0417\)</span> or 0.0497. This term is still statistically significant at the 0.05 level under the quasi-Poisson model, but the evidence is not as strong (quasi-Poisson p-value of .024 vs.&nbsp;Poisson p-value of .007). In fact, after adjusting for overdispersion (extra variation), all model coefficients have lower test statistics and higher p-values because standard errors were all increased by a factor of 1.19 (<span class="math inline">\(\sqrt{\hat\phi}=\sqrt{1.415}=1.19\)</span>), while estimated coefficients remain unchanged.</p>
<p>Furthermore, tests for individual parameters are now based on the t-distribution rather than a standard normal distribution, with test statistic <span class="math inline">\(t=\frac{\hat\beta}{SE_Q(\hat\beta)}\)</span> following an (approximate) t-distribution with <span class="math inline">\(n-p\)</span> degrees of freedom if the null hypothesis is true (<span class="math inline">\(H_O:\beta=0\)</span>). Drop-in-deviance tests can be similarly adjusted for overdispersion in the quasi-Poisson model. In this case, you can divide the test statistic (per degree of freedom) by the estimated dispersion parameter and compare the result to an F-distribution with the difference in the model degrees of freedom for the numerator and the degrees of freedom for the larger model in the denominator. That is, <span class="math inline">\(F=\frac{\textrm{drop in deviance}}{\textrm{difference in df}} / {\hat\phi}\)</span> follows an (approximate) F-distribution when the null hypothesis is true (<span class="math inline">\(H_0\)</span>: reduced model sufficient). The output below tests for the effect of location controlling for age after adjusting for overdispersion (extra variance):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>modela2_quasi <span class="ot">&lt;-</span> <span class="fu">glm</span>(total <span class="sc">~</span> age <span class="sc">+</span> age2,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> quasipoisson, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> fHH1)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>drop_in_dev <span class="ot">&lt;-</span> <span class="fu">anova</span>(modela2_quasi, modela2L_quasi, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##   ResidDF ResidDev        F Df       pval
## 1    1497 2200.944       NA NA         NA
## 2    1493 2187.800 2.322264  4 0.05477322</code></pre>
</div>
</div>
<p>Here, after adjusting for overdispersion, we find that there is <em>not</em> statistically significant evidence at the 0.05 level (<span class="math inline">\(F=2.32, p=.055\)</span>) that mean household size differs among regions after adjusting for age. Even though our drop-in-deviance test from <a href="#sec-addcov-hhsize" class="quarto-xref">Section&nbsp;1.7.2</a> indicated that location was statistically significant, that test had (incorrectly) assumed that mean counts were equal to the variance in counts. Now we have shown after accounting for violations of that assumption, the statistical significance disappears.</p>
<p>As we hinted in <a href="#sec-tukeyHSD" class="quarto-xref">Section&nbsp;1.7.3</a>, we can simplify our quasi-Poisson model by replacing <code>location</code> with an indicator variable for the Visayas region, since that region seems to have notably higher household sizes. In that case, there is statistically significant evidence (<span class="math inline">\(t = 2.61, p = .009\)</span>) that mean household sizes is higher in the Visayas region than other regions after controlling for age.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fHH1 <span class="ot">&lt;-</span> fHH1 <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">visayas =</span> <span class="fu">ifelse</span>(location <span class="sc">==</span> <span class="st">"Visayas"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>modela2v_quasi <span class="ot">&lt;-</span> <span class="fu">glm</span>(total <span class="sc">~</span> age <span class="sc">+</span> age2 <span class="sc">+</span> visayas,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> quasipoisson, </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> fHH1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##                  Estimate   Std. Error   t value     Pr(&gt;|t|)
## (Intercept) -0.3559192469 2.130540e-01 -1.670559 9.501804e-02
## age          0.0703621003 8.203459e-03  8.577126 2.391770e-17
## age2        -0.0007028707 7.626716e-05 -9.215902 1.013783e-19
## visayas      0.0845339123 3.240597e-02  2.608591 9.182152e-03</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Residual deviance =  2191.35  on  1496 df 
##  Dispersion parameter =  1.41624</code></pre>
</div>
</div>
<p><a href="#tbl-compTable" class="quarto-xref">Table&nbsp;3</a> summarizes the comparison between Poisson inference (tests and confidence intervals assuming no overdispersion) and quasi-Poisson inference (tests and confidence intervals after accounting for overdispersion).</p>
<div class="cell">
<div id="tbl-compTable" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-compTable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Comparison of Poisson and quasi-Poisson inference.
</figcaption>
<div aria-describedby="tbl-compTable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 16%">
<col style="width: 42%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Poisson</th>
<th style="text-align: left;">quasi-Poisson</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Estimate</td>
<td style="text-align: left;"><span class="math inline">\(\hat{\beta}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\hat{\beta}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Std error</td>
<td style="text-align: left;"><span class="math inline">\(SE(\hat{\beta})\)</span></td>
<td style="text-align: left;"><span class="math inline">\(SE_Q(\hat{\beta}) = \sqrt{\hat{\phi}} SE(\hat{\beta})\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wald-type test stat</td>
<td style="text-align: left;"><span class="math inline">\(Z = \hat{\beta} / SE(\hat{\beta})\)</span></td>
<td style="text-align: left;"><span class="math inline">\(t = \hat{\beta} / SE_Q(\hat{\beta})\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Confidence interval</td>
<td style="text-align: left;"><span class="math inline">\(\hat{\beta} \pm z^{'} SE(\hat{\beta})\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\hat{\beta} \pm t^{'} SE_Q(\hat{\beta})\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Drop in deviance test</td>
<td style="text-align: left;"><span class="math inline">\(\chi^2 = \textrm{resid dev(reduced) - resid dev(full)}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(F = (\chi^2 / \textrm{difference in df}) / \hat{\phi}\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="negative-binomial-modeling" class="level3">
<h3 class="anchored" data-anchor-id="negative-binomial-modeling">Negative Binomial Modeling</h3>
<p>Another approach to dealing with overdispersion is to model the response using a negative binomial instead of a Poisson distribution. An advantage of this approach is that it introduces another parameter in addition to <span class="math inline">\(\lambda\)</span>, which gives the model more flexibility and, as opposed to the quasi-Poisson model, the negative binomial model assumes an explicit likelihood model. You may recall that negative binomial random variables take on non-negative integer values, which is consistent with modeling counts. This model posits selecting a <span class="math inline">\(\lambda\)</span> for each household and then generating a count using a Poisson random variable with the selected <span class="math inline">\(\lambda\)</span>. With this approach, the counts will be more dispersed than would be expected for observations based on a single Poisson variable with rate <span class="math inline">\(\lambda\)</span>. (See Guided Exercises on the Gamma-Poisson mixture in [Chapter 3: Distribution Theory].)</p>
<p>Mathematically, you can think of the negative binomial model as a Poisson model where <span class="math inline">\(\lambda\)</span> is also random, following a gamma distribution. Specifically, if <span class="math inline">\(Y|\lambda \sim \textrm{Poisson}(\lambda)\)</span> and <span class="math inline">\(\lambda \sim \textrm{gamma}(r,\frac{p}{1-p})\)</span>, then <span class="math inline">\(Y \sim \textrm{NegBinom}(r,p)\)</span> where <span class="math inline">\(E(Y)=\frac{r(1-p)}{p}=\mu\)</span> and <span class="math inline">\(Var(Y)=\frac{r(1-p)}{p^2}=\mu+\frac{\mu^2}{r}\)</span>. The overdispersion in this case is given by <span class="math inline">\(\frac{\mu^2}{r}\)</span>, which approaches 0 as <span class="math inline">\(r\)</span> increases (so smaller values of <span class="math inline">\(r\)</span> indicate greater overdispersion).</p>
<p>Here is what happens if we apply a negative binomial regression model to the age-location model, which we’ve already established suffers from overdispersion issues under regular Poisson regression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Account for overdispersion with negative binomial model</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>modela2L_nb <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(total <span class="sc">~</span> age <span class="sc">+</span> age2 <span class="sc">+</span> location,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> fHH1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##                           Estimate   Std. Error    z value     Pr(&gt;|z|)
## (Intercept)          -0.3753150415 2.075749e-01 -1.8080943 7.059183e-02
## age                   0.0698522773 7.850275e-03  8.8980677 5.682738e-19
## age2                 -0.0006961686 7.270265e-05 -9.5755605 1.013063e-21
## locationMetroManila   0.0562445198 5.507030e-02  1.0213222 3.071018e-01
## locationDavaoRegion  -0.0218828168 6.249733e-02 -0.3501400 7.262336e-01
## locationVisayas       0.1104058511 4.873477e-02  2.2654432 2.348550e-02
## locationIlocosRegion  0.0577155088 6.146034e-02  0.9390692 3.476952e-01</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Residual deviance =  1645.614  on  1493 df 
##  Dispersion parameter (theta) =  9.929626</code></pre>
</div>
</div>
<p>These results are very similar to the quasi-Poisson model in terms of estimated coefficients, standard errors, test statistics, and p-values, even though negative binomial standard errors are somewhat smaller across the board. Note also that tests of individual coefficients are based on an approximate t-distribution in quasi-Poisson modeling, while the same tests in negative binomial modeling are based on a normal distribution. This is because the negative binomial model relies on an exact likelihood function, while the quasi-Poisson model relies on an ad-hoc approximation. Similarly, a drop-in-deviance test for location based on the negative binomial model is based on an exact chi-square distribution; we find a p-value barely above 0.05 (<span class="math inline">\(\chi^2 = 9.43, p=.051\)</span>) just as with the quasi-Poisson model, showing again that location is not statistically significant after controlling for age. When we replace <code>location</code> with an indicator variable for the Visayas region, there is again statistically significant evidence (<span class="math inline">\(Z = 2.60, p = .009\)</span>) that mean household sizes is higher in the Visayas region than other regions after controlling for age.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>modela2_nb <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(total <span class="sc">~</span> age <span class="sc">+</span> age2,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> fHH1)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>drop_in_dev <span class="ot">&lt;-</span> <span class="fu">anova</span>(modela2_nb, modela2L_nb, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##                       ResidDF  ResidDev    ChiSq Df       pval
## age + age2               1497 -6486.487       NA NA         NA
## age + age2 + location    1493 -6477.061 9.425923  4 0.05129183</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Account for overdispersion with negative binomial model</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>modela2v_nb <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(total <span class="sc">~</span> age <span class="sc">+</span> age2 <span class="sc">+</span> visayas,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> fHH1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##                 Estimate   Std. Error   z value     Pr(&gt;|z|)
## (Intercept) -0.349058409 2.041218e-01 -1.710050 8.725665e-02
## age          0.069899679 7.842410e-03  8.913036 4.965388e-19
## age2        -0.000696785 7.261621e-05 -9.595447 8.355450e-22
## visayas      0.083442959 3.207510e-02  2.601487 9.282047e-03</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Residual deviance =  1645.941  on  1496 df 
##  Dispersion parameter (theta) =  9.869123</code></pre>
</div>
</div>
</section>
<section id="choosing-a-model-for-overdispersion" class="level3">
<h3 class="anchored" data-anchor-id="choosing-a-model-for-overdispersion">Choosing a Model for Overdispersion</h3>
<p>With our Philippine household size data, quasi-Poisson and negative binomial modeling provided very similar results while accounting for lack of fit due to overdispersion, but this will not always be the case. How, then, should we choose between quasi-Poisson and negative binomial approaches when the choice makes a meaningful difference?</p>
<p>First, note that in quasi-Poisson regression, the parameter <span class="math inline">\(\phi\)</span> only affects the estimation of the standard errors, so the predicted <span class="math inline">\(\beta\)</span> values will be the same as the ordinary Poisson model. However, the entire likelihood is different in negative binomial regression compared to Poisson, and unusually large and small values (with large residuals) have different weights. This means that the estimated <span class="math inline">\(\beta\)</span> values in negative binomial regression will be different than in the ordinary Poisson model, although our interpretation of them is the same.</p>
<p>More significantly, recall that in quasi-Poisson modeling we assume <span class="math inline">\(Var(Y) = \phi\lambda\)</span>, while in negative binomial modeling we assume <span class="math inline">\(Var(Y) = \mu + \mu^2/r\)</span> where <span class="math inline">\(E(Y) = \mu\)</span>. Thus, we assume that there is a linear relationship between the mean and variance of our response in quasi-Poisson, but a quadratic (curved) relationship in negative binomial. Therefore, one graphical way to to determine which modeling approach might be more appropriate is:</p>
<ul>
<li>fit a model using Poisson regression</li>
<li>generate predicted responses for each observation in the original data</li>
<li>sort the predicted responses and form a number of equally-sized groups</li>
<li>calculate the mean and variance in each group</li>
<li>generate a scatterplot of the means vs.&nbsp;the variances</li>
<li>overlap a line with intercept 0 and slope 1 (to reflect the relationship under basic Poisson regression) and a smoother to determine if the points tend to fall on a line (quasi-Poisson) or a quadratic curve (negative binomial)</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="fig-mean-var" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mean-var-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-mean-var-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mean-var-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Mean and variance of predicted household sizes based on a model with a Visayas indicator and age as a quadratic predictor. Each point is based on a group of 50 households after they were sorted from lowest to highest predicted size. The black line has slope 1 and indicates the expected relationship under a Poisson model.<br>
The blue curve indicates the best-fitting smoother to the set of 30 points.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-mean-var" class="quarto-xref">Figure&nbsp;9</a>, we see that there is more variance than expected under the Poisson model for each mean household size, but the relationship is slightly more quadratic than linear. This would argue for a negative binomial model in this instance. The negative binomial model also works reasonably well in most situations with a linear relationship between mean and variance, and it has the additional advantage of leading to a true likelihood and a true likelihood ratio (drop-in-deviance) test. AIC values can also be compared between non-nested negative binomial models, but since it is not likelihood-based, we cannot use (or even compute!) AIC values to compare non-nested quasi-Poisson models to each other. This also means that AIC is not usable for determining whether a quasi-Poisson or negative binomial model is preferred. We can compare the AIC of the negative binomial model to the Poisson as another way of checking for overdispersion, though this is usually redundant after robust EDA.</p>
<p>Negative binomial models, because the overdispersion parameter <span class="math inline">\(r\)</span> must be positive, are unable to handle <em>underdispersion</em> (where the variance is less than the mean), while quasi-Poisson models can handle underdispersion simply by estimating <span class="math inline">\(\phi\)</span> as less than 1.</p>
</section>
<section id="a-more-detailed-look-at-deviance-residuals-optional" class="level3">
<h3 class="anchored" data-anchor-id="a-more-detailed-look-at-deviance-residuals-optional">A more detailed look at deviance residuals (Optional)</h3>
</section>
</section>
<section id="case-study-bald-eagles" class="level2">
<h2 class="anchored" data-anchor-id="case-study-bald-eagles">Case Study: Bald Eagles</h2>
<p>Every year in late December, since 1921, birdwatchers in the Hamilton area of Ontario, Canada, have counted and recorded all the birds they see or hear in a day. The data was made available by the <a href="https://www.birdscanada.org/">Bird Studies Canada website</a> and distributed through the R for Data Science TidyTuesday project <span class="citation" data-cites="eagles2019">[@eagles2019]</span>. We are particularly interested in how the Bald Eagle population has changed over time.</p>
<section id="data-organization" class="level3">
<h3 class="anchored" data-anchor-id="data-organization">Data Organization</h3>
<p>Each row of <code>bald_eagles.csv</code> contains information about bald eagles counts in Hamilton, Ontario, for one year. There are 37 rows covering 1981 through 2017. The variables include:</p>
<ul>
<li><code>year</code> = year of data collection</li>
<li><code>count</code> = number of birds observed</li>
<li><code>hours</code> = total person-hours of observation period</li>
<li><code>count_per_hour</code> = count divided by hours</li>
<li><code>count_per_week</code> = count_per_hour multiplied by 168 hours per week</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 10 × 8
##     year count hours count_per_hour count_per_week weeks log_count_per_week
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;              &lt;dbl&gt;
##  1  2008     9  227          0.0396           6.66  1.35               1.97
##  2  2009     5  194          0.0258           4.33  1.15               1.57
##  3  2010     3  226.         0.0133           2.23  1.35               1.00
##  4  2011     4  228.         0.0175           2.95  1.36               1.24
##  5  2012     3  195.         0.0154           2.59  1.16               1.13
##  6  2013    11  182.         0.0604          10.1   1.08               2.36
##  7  2014     6  179.         0.0335           5.62  1.07               1.81
##  8  2015     7  221          0.0317           5.32  1.32               1.76
##  9  2016     3  217.         0.0138           2.33  1.29               1.04
## 10  2017    12  199.         0.0604          10.1   1.18               2.36
## # ℹ 1 more variable: year_1981 &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="exploratory-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-eagle-count" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-eagle-count-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-eagle-count-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-eagle-count-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Histogram of number of bald eagle sitings by year.<br>

</figcaption>
</figure>
</div>
</div>
</div>
<p>A graph of the number of bald eagles, <a href="#fig-eagle-count" class="quarto-xref">Figure&nbsp;10</a>, reveals the pattern often found with distributions of counts of relatively rare events. In many years, no eagles or very few eagles were sighted, but a few years had larger eagle counts, making for a distribution that appears to be skewed right and far from normal. Therefore, Poisson regression should be used to model our data; Poisson random variables are often used to represent counts (e.g., number of bald eagles) per unit of time or space (e.g., one year).</p>
<p>In this data, there are two covariates of interest: time (as measured by <code>year</code> in which the count was conducted) and observation effort (as measured by the number of <code>weeks</code> people observed birds). Our primary question is: What trends over time do we see in bald eagle counts? <a href="#fig-eagles-by-year" class="quarto-xref">Figure&nbsp;11</a> shows how both bald eagle counts and observation effort changes over time. We can see an increase in both count and observational effort shortly after the year 2000.</p>
<div id="fig-eagles-by-year" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-eagles-by-year-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-eagles-by-year" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-eagles-by-year-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-eagles-by-year-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-eagles-by-year-1.png" class="img-fluid figure-img" data-ref-parent="fig-eagles-by-year" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-eagles-by-year-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Bald eagle counts vs.&nbsp;year
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-eagles-by-year" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-eagles-by-year-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-eagles-by-year-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-eagles-by-year-2.png" class="img-fluid figure-img" data-ref-parent="fig-eagles-by-year" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-eagles-by-year-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Hours of observation vs.&nbsp;year
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-eagles-by-year-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Scatterplots of bald eagle counts and person-hours of observation over time with loess smoothers.
</figcaption>
</figure>
</div>
<p>While a Poisson regression model is a good first choice because the responses are counts per year, it is important to note that the counts are not directly comparable because they come from different amounts of observation time. In more recent years, we see higher counts but also more person-hours of observation, as might be expected. This issue sometimes is referred to as the need to account for <em>sampling effort</em>. We cannot directly compare the 2 eagles observed in 1985 to the 7 eagles observed in 2015 when there were only 143 person-hours (0.85 weeks) of observation in 1985 compared with 221 person-hours (1.32 weeks) in 2015. It would be natural to expect more eagles observed in 2015 with more sampling effort. We can take the differences in observation time into account by including an <strong>offset</strong> in our model, which we will discuss in the next section.</p>
<p>In terms of our EDA, we will examine time trends in the <em>rate</em> of bald eagles sightings; for example, we will calculate the bald eagle counts per week (<span class="math inline">\(\frac{\textrm{number of bald eagles}}{\textrm{hours of observation}} \cdot (168 \textrm{ hours/week})\)</span>). In <a href="#fig-eagle-rate-by-year" class="quarto-xref">Figure&nbsp;12</a>, we see that an increase in bald eagles observed per week is still visible after 2000, but the rate of increase is slightly slower than when plotting raw counts.</p>
<div id="fig-eagle-rate-by-year" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-eagle-rate-by-year-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-eagle-rate-by-year" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-eagle-rate-by-year-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-eagle-rate-by-year-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-eagle-rate-by-year-1.png" class="img-fluid figure-img" data-ref-parent="fig-eagle-rate-by-year" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-eagle-rate-by-year-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Bald eagle counts per week vs.&nbsp;year
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-eagle-rate-by-year" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-eagle-rate-by-year-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-eagle-rate-by-year-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-eagle-rate-by-year-2.png" class="img-fluid figure-img" data-ref-parent="fig-eagle-rate-by-year" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-eagle-rate-by-year-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Log of bald eagle counts per week vs.&nbsp;year
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-eagle-rate-by-year-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Scatterplots of the bald eagle count per week of observation (with and without log transformation) with loess smoother.
</figcaption>
</figure>
</div>
</section>
</section>
<section id="offsets-accounting-for-sampling-effort" class="level2">
<h2 class="anchored" data-anchor-id="offsets-accounting-for-sampling-effort">Offsets: Accounting for Sampling Effort</h2>
<p>Although working with the observed rates (per week, or per 168 hours) is useful during the exploratory data analysis, we do not use these rates explicitly in the model. The counts (per year) are the Poisson responses when modeling, so we must take into account the observation time in a different way. Our approach is to include a term on the right side of the model called an <strong>offset</strong>, which is the log of the weeks of observation. There is an intuitive heuristic for the form of the offset. If we think of <span class="math inline">\(\lambda\)</span> as the mean number of bald eagles per year, then <span class="math inline">\(\lambda/\textrm{weeks}\)</span> represents the number per week of observation time, so that the yearly count is adjusted to be comparable across different amounts of observation time. Adjusting the yearly count by observation time is equivalent to adding <span class="math inline">\(log(\textrm{weeks})\)</span> to the right-hand side of the Poisson regression equation—essentially adding a predictor with a fixed coefficient of 1:</p>
<p><span class="math display">\[\begin{align*}
log(\frac{\lambda}{\textrm{weeks}} )= \beta_0 + \beta_1(\textrm{type}) \nonumber \\
log(\lambda)-log(\textrm{weeks}) = \beta_0 + \beta_1(\textrm{type}) \nonumber \\
log(\lambda) = \beta_0 + \beta_1(\textrm{type}) + log(\textrm{weeks})
\end{align*}\]</span></p>
<p>While this heuristic is helpful, it is important to note that it is <em>not</em> <span class="math inline">\(\frac{\lambda}{ \textrm{weeks}}\)</span> that we are modeling. We are still modeling <span class="math inline">\(log(\lambda)\)</span>, but we’re adding an offset to adjust for differing observation time, where the offset has the unusual feature that the coefficient is fixed at 1.0. As a result, no estimated coefficient for <code>weeks</code> or <span class="math inline">\(log(\textrm{weeks})\)</span> will appear in the output. As this heuristic illustrates, modeling <span class="math inline">\(log(\lambda)\)</span> and adding an offset is equivalent to modeling rates, and coefficients can be interpreted in terms of rates.</p>
<section id="modeling-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="modeling-assumptions">Modeling Assumptions</h3>
<p>In <a href="#fig-mean-var-eagles" class="quarto-xref">Figure&nbsp;13</a>, we see that variances in rates of eagle sightings are approximately equal to the mean rate of eagle sightings except in the final group of years. Thus, we have some reason to question the Poisson regression assumption of variability equal to the mean; we will have to return to this issue after some initial modeling. We might consider a negative binomial model which allows a quadratic form to the mean-variance relationship.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-mean-var-eagles" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mean-var-eagles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-mean-var-eagles-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mean-var-eagles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Mean and variance of bald eagle counts per week of observation effort. Each point is based on a group of 6-7 years.<br>
The black line has slope 1 and indicates the expected relationship under a Poisson model. The blue curve indicates the best-fitting smoother to the set of 6 points.
</figcaption>
</figure>
</div>
</div>
</div>
<p>As far as other model assumptions, linearity with respect to <span class="math inline">\(log(\lambda / \textrm{weeks})\)</span> seems pretty reasonable from <a href="#fig-eagle-rate-by-year" class="quarto-xref">Figure&nbsp;12</a>, once zeros are accounted for. Independence in counts from year to year also seems reasonable based on the data collection description.</p>
</section>
<section id="modeling-results" class="level3">
<h3 class="anchored" data-anchor-id="modeling-results">Modeling Results</h3>
<p>We are interested primarily in trends over time in eagle sightings. We have no control variables other than sampling effort, so we simply fit a model with <code>year</code> (centered at 1981) and our offset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>model_eagles <span class="ot">&lt;-</span> <span class="fu">glm</span>(count <span class="sc">~</span> year_1981,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> poisson,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">offset =</span> <span class="fu">log</span>(weeks),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> eagles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##                Estimate Std. Error   z value     Pr(&gt;|z|)
## (Intercept) -0.79971104 0.31969178 -2.501506 1.236662e-02
## year_1981    0.07566483 0.01155782  6.546634 5.884818e-11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Residual deviance =  42.39031  on  35 df 
##  Dispersion parameter =  1</code></pre>
</div>
</div>
<p>From our model, bald eagle counts are significantly increasing over time (Z = 6.55, p &lt; .001), even after adjusting for observation time. The estimated coefficient of 0.0757 means that the average eagle sighting rate per week has grown about 7.9% per year (since <span class="math inline">\(e^{0.0757}=1.0786\)</span>) in Hamilton, Ontario. A Wald-type confidence interval for this factor can be constructed by first calculating a CI for the coefficient (<span class="math inline">\(0.0757 \pm 1.96 \cdot 0.0116\)</span>) and then exponentiating to give 5.4% to 10.3%. From the estimated intercept, we see that average eagle sightings per week in 1981 are 0.45 (since <span class="math inline">\(e^{-0.7997}=0.4495\)</span>). Adjustments for potential overdispersion using either quasi-Poisson or negative binomial regression provide minimal changes to model coefficients and tests; see below for output from fitting a negative binomial regression model.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##                Estimate Std. Error   z value     Pr(&gt;|z|)
## (Intercept) -0.79984025 0.33444641 -2.391535 1.677809e-02
## year_1981    0.07571707 0.01239979  6.106318 1.019559e-09</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Residual deviance =  36.97719  on  35 df 
##  Dispersion parameter (theta) =  19.33161</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-drinking" class="level2">
<h2 class="anchored" data-anchor-id="sec-drinking">Case Study: Weekend Drinking</h2>
<p>Sometimes when analyzing Poisson data, you may see many more zeros in your data set than you would expect for a Poisson random variable. For example, an informal survey of students in an introductory statistics course included the question, “How many alcoholic drinks did you consume last weekend?”. This survey was conducted on a dry campus where no alcohol is officially allowed, even among students of drinking age, so we expect that some portion of the respondents never drink. The non-drinkers would thus always report zero drinks. However, there will also be students who are drinkers reporting zero drinks because they just did not happen to drink during the past weekend. Our zeros, then, are a <strong>mixture</strong> of responses from non-drinkers and drinkers who abstained during the past weekend. Ideally, we’d like to sort out the non-drinkers and drinkers when performing our analysis.</p>
<section id="research-question" class="level3">
<h3 class="anchored" data-anchor-id="research-question">Research Question</h3>
<p>The purpose of this survey is to explore factors related to drinking behavior on a dry campus. What proportion of students on this dry campus never drink? What factors, such as off-campus living and sex, are related to whether students drink? Among those who do drink, to what extent is moving off campus associated with the number of drinks in a weekend? It is commonly assumed that males’ alcohol consumption is greater than females’; is this true on this campus? Answering these questions would be a simple matter if we knew who was and was not a drinker in our sample. Unfortunately, the non-drinkers did not identify themselves as such, so we will need to use the data available with a model that allows us to estimate the proportion of drinkers and non-drinkers.</p>
</section>
<section id="data-organization-1" class="level3">
<h3 class="anchored" data-anchor-id="data-organization-1">Data Organization</h3>
<p>Each line of <code>weekendDrinks.csv</code> contains data provided by a student in an introductory statistics course. In this analysis, the response of interest is the respondent’s report of the number of alcoholic <code>drinks</code> they consumed the previous weekend, whether the student lives <code>off.campus</code> (recorded as 0 = no and 1 = yes), and <code>sex</code> (where two levels were reported: “f” for female and “m” for male). We will also consider whether a student is likely a <code>firstYear</code> student based on the <code>dorm</code> they live in. Here is a sample of observations from this data set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(zip_data[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  drinks sex   off_campus first_year
   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;lgl&gt;     
1      0 f              0 TRUE      
2      5 f              0 FALSE     
3     10 m              0 FALSE     
4      0 f              0 FALSE     
5      0 m              0 FALSE     
6      3 f              0 FALSE     </code></pre>
</div>
</div>
</section>
<section id="exploratory-data-analysis-1" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis-1">Exploratory Data Analysis</h3>
<p>As always we take stock of the amount of data; here there are 77 observations. Large sample sizes are preferred for the type of model we will consider, and n=77 is on the small side. We proceed with that in mind.</p>
<p>A premise of this analysis is that we believe that those responding with zero drinks are coming from a mixture of non-drinkers and drinkers who abstained the weekend of the survey.</p>
<ul>
<li><strong>Non-drinkers</strong>: respondents who never drink and would always reply with zero.</li>
<li><strong>Drinkers</strong>: this includes those responding with one or more drinks and also people who are drinkers but did not happen to imbibe the past weekend. This second group replied zero in the survey but are not considered non-drinkers.</li>
</ul>
<div id="fig-obsVmodel" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-obsVmodel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-obsVmodel" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-obsVmodel-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-obsVmodel-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-obsVmodel-1.png" class="img-fluid figure-img" style="width:60.0%" data-ref-parent="fig-obsVmodel">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-obsVmodel-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Observed
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-obsVmodel" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-obsVmodel-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-obsVmodel-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-obsVmodel-2.png" class="img-fluid figure-img" style="width:60.0%" data-ref-parent="fig-obsVmodel">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-obsVmodel-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Modeled
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-obsVmodel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Distributions of observed and modeled number of drinks.
</figcaption>
</figure>
</div>
<p>Beginning the EDA with the response, number of drinks, we find that over 46% of the students reported no drinks during the past weekend. <a href="#fig-obsVmodel" class="quarto-xref">Figure&nbsp;14</a>(a) portrays the observed number of drinks reported by the students. The mean number of drinks reported the past weekend is 2.013. Our sample consists of 72.7% female students, 23.4% first-year students, and 9.1% of students who live off campus.</p>
<p>Because our response is a count, it is natural to consider a Poisson regression model. You may recall that a Poisson distribution has only one parameter, <span class="math inline">\(\lambda\)</span>, for its mean and variance. Here we will include an additional parameter, <span class="math inline">\(\alpha\)</span>. We define <span class="math inline">\(\alpha\)</span> to be the true proportion of <em>non-drinkers</em> in the population.</p>
<p>The next step in the EDA is especially helpful if you suspect your data contains excess zeros. <a href="#fig-obsVmodel" class="quarto-xref">Figure&nbsp;14</a>(b) is what we might expect to see under a Poisson model. Bars represent the probabilities for a Poisson distribution (using the Poisson probability formula) with <span class="math inline">\(\lambda\)</span> equal to the mean observed number of drinks, 2.013 drinks per weekend. Comparing this Poisson distribution to what we observed (<a href="#fig-obsVmodel" class="quarto-xref">Figure&nbsp;14</a>(a)), it is clear that many more zeros have been reported by the students than you would expect to see if the survey observations were coming from a Poisson distribution. This doesn’t surprise us because we had expected a subset of the survey respondents to be non-drinkers; i.e., they would not be included in this Poisson process. This circumstance actually arises in many Poisson regression settings. We will define <span class="math inline">\(\lambda\)</span> to be the mean number of drinks <em>among those who drink</em>, and <span class="math inline">\(\alpha\)</span> to be the proportion of <em>non-drinkers</em> (“true zeros”). Then, we will attempt to model <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\alpha\)</span> (or functions of <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\alpha\)</span>) simultaneously using covariates like sex, first-year status, and off-campus residence. This type of model is referred to as a <strong>zero-inflated Poisson model</strong> or <strong>ZIP model</strong>. </p>
<p>We should then continue our EDA by examining potential covariates in relation to <em>two</em> response variables: whether a respondent had any 0 drinks or not (binary) and the number of drinks a respondent reported for last weekend (count). While the binary response can provide information about which covariates may be related to <span class="math inline">\(\alpha\)</span>, the information is imperfect since <span class="math inline">\(\alpha\)</span> is the proportion of true non-drinkers, not the proportion of those who didn’t drink last weekend. Similarly, while the count response can provide information about which covariates may be related to <span class="math inline">\(\lambda\)</span>, this information is also imperfect, because <span class="math inline">\(\lambda\)</span> describes the mean number of drinks among those who drink, not among all respondents. Nevertheless, a few exploratory plots and tables can help guide us toward good starting points in our modeling.</p>
<p>As we see in <a href="#fig-binary-drinks" class="quarto-xref">Figure&nbsp;15</a> and <a href="#fig-count-drinks" class="quarto-xref">Figure&nbsp;16</a>, both the proportion of respondents with at least one drink and the number of drinks last weekend appear higher for students who identify as male, students living off campus, and students in their first year.</p>
<div id="fig-binary-drinks" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binary-drinks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-binary-drinks" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-binary-drinks-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-binary-drinks-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-binary-drinks-1.png" class="img-fluid figure-img" data-ref-parent="fig-binary-drinks" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-binary-drinks-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Sex
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-binary-drinks" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-binary-drinks-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-binary-drinks-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-binary-drinks-2.png" class="img-fluid figure-img" data-ref-parent="fig-binary-drinks" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-binary-drinks-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Living location
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-binary-drinks" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-binary-drinks-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-binary-drinks-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-binary-drinks-3.png" class="img-fluid figure-img" data-ref-parent="fig-binary-drinks" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-binary-drinks-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Class year
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binary-drinks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: Bar plots to examine potential predictors for the binary part of a ZIP model for weekend drinking.
</figcaption>
</figure>
</div>
<div id="fig-count-drinks" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-count-drinks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-count-drinks" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-count-drinks-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-count-drinks-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-count-drinks-1.png" class="img-fluid figure-img" data-ref-parent="fig-count-drinks" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-count-drinks-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Sex
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-count-drinks" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-count-drinks-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-count-drinks-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-count-drinks-2.png" class="img-fluid figure-img" data-ref-parent="fig-count-drinks" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-count-drinks-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Living location
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-count-drinks" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-count-drinks-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-count-drinks-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-count-drinks-3.png" class="img-fluid figure-img" data-ref-parent="fig-count-drinks" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-count-drinks-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Class year
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-count-drinks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: Boxplots to examine potential predictors for the count portion of a ZIP model for weekend drinking.
</figcaption>
</figure>
</div>
</section>
</section>
<section id="sec-ZIPmodel" class="level2">
<h2 class="anchored" data-anchor-id="sec-ZIPmodel">Zero-Inflated Poisson Models</h2>
<section id="initial-models" class="level3">
<h3 class="anchored" data-anchor-id="initial-models">Initial Models</h3>
<p>We first fit a simple Poisson model with the covariates <code>off_campus</code> and <code>sex</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>pois_m1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(drinks <span class="sc">~</span> off_campus <span class="sc">+</span> sex, </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> poisson,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> zip_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>##              Estimate Std. Error  z value     Pr(&gt;|z|)
## (Intercept) 0.1292692  0.1241189 1.041494 2.976462e-01
## off_campus  0.8976455  0.2008250 4.469790 7.829627e-06
## sexm        1.1153735  0.1610661 6.924943 4.361498e-12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Residual deviance =  230.544  on  74 df 
##  Dispersion parameter =  1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exponentiated coefficients</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(pois_m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## (Intercept)  off_campus        sexm 
##    1.137996    2.453819    3.050707</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Goodness-of-fit test</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>gof_pvalue <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(pois_m1<span class="sc">$</span>deviance, pois_m1<span class="sc">$</span>df.residual)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>gof_pvalue</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0</code></pre>
</div>
</div>
<p>Both covariates are statistically significant, but a goodness-of-fit test reveals that there remains significant lack-of-fit (residual deviance: 230.54 with only 74 df; p&lt;.001 based on <span class="math inline">\(\chi^2\)</span> test with 74 df). In the absence of important missing covariates or extreme observations, this lack-of-fit may be explained by the presence of a group of non-drinkers.</p>
</section>
<section id="fitting-a-zip-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-a-zip-model">Fitting a ZIP Model</h3>
<p>A zero-inflated Poisson regression model to take non-drinkers into account consists of two parts:</p>
<ul>
<li>One part models the association, among drinkers, between number of drinks and the predictors of sex and off-campus residence.</li>
<li>The other part uses a predictor for first-year status to obtain an estimate of the proportion of non-drinkers based on the reported zeros.</li>
</ul>
<p>The form for each part of the model follows. The first part looks like an ordinary Poisson regression model:</p>
<p><span class="math display">\[
log(\lambda)=\beta_0+\beta_1\textrm{off\_campus}+ \beta_2\textrm{sex}
\]</span> where <span class="math inline">\(\lambda\)</span> is the mean number of drinks in a weekend <em>among those who drink</em>. The second part has the form</p>
<p><span class="math display">\[
logit(\alpha)=\beta_0+\beta_1\textrm{first\_year}
\]</span> where <span class="math inline">\(\alpha\)</span> is the probability of being in the non-drinkers group and <span class="math inline">\(logit(\alpha) = log( \alpha/(1-\alpha))\)</span>. We’ll provide more detail on the logit in [Chapter 6: Logistic Regression]. There are many ways in which to structure this model; here we use different predictors in the two pieces, although it would have been perfectly fine to use the same predictors for both pieces, or even no predictors for one of the pieces.</p>
<p>How is it possible to fit such a model? We cannot observe whether a respondent is a drinker or not (which probably would’ve been good to ask, in retrospect!). The ZIP model is a special case of a more general type of statistical model referred to as a <strong>latent variable model</strong>. More specifically, it is a type of a <strong>mixture model</strong> where observations for one or more groups occur together and the group membership is unknown. Zero-inflated models are a particularly common example of a mixture model, but the response does not need to follow a Poisson distribution. Likelihood methods are at the core of this methodology, but fitting is an iterative process where it is necessary to start out with some guesses (or starting values). In general, it is important to know that models like ZIP exist, although we’ll only explore interpretations and fitting options for a single case study here.</p>
<p>Here is the general idea of how ZIP models are fit. Imagine that the graph of the Poisson distribution in <a href="#fig-obsVmodel" class="quarto-xref">Figure&nbsp;14</a>(b) is removed from the observed data distribution in <a href="#fig-obsVmodel" class="quarto-xref">Figure&nbsp;14</a>(a). Some zero responses will remain. These would correspond to non-drinkers, and the proportion of all observations these zeros constitute might make a reasonable estimate for <span class="math inline">\(\alpha\)</span>, the proportion of non-drinkers. The likelihood is used and some iterating in the fitting process is involved because the Poisson distribution in <a href="#fig-obsVmodel" class="quarto-xref">Figure&nbsp;14</a>(b) is based on the mean of the observed data, which means it is the average among all students, not only among drinkers. Furthermore, the likelihood incorporates the predictors, <code>sex</code> and <code>off_campus</code>. So there is a little more to it than computing the proportion of zeros, but this heuristic should provide you a general idea of how these kinds of models are fit. We will use the R function <code>zeroinfl</code> from the package <code>pscl</code> to fit a ZIP model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>zip_m2 <span class="ot">&lt;-</span> <span class="fu">zeroinfl</span>(drinks <span class="sc">~</span> off_campus <span class="sc">+</span> sex <span class="sc">|</span> first_year, </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> zip_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>## $count
##              Estimate Std. Error  z value     Pr(&gt;|z|)
## (Intercept) 0.7542747  0.1440035 5.237891 1.624221e-07
## off_campus  0.4159420  0.2058602 2.020507 4.333078e-02
## sexm        1.0209002  0.1751937 5.827264 5.634331e-09
## 
## $zero
##                  Estimate Std. Error   z value   Pr(&gt;|z|)
## (Intercept)    -0.6036151  0.3114485 -1.938090 0.05261230
## first_yearTRUE  1.1363880  0.6095155  1.864412 0.06226388</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Log likelihood =  -140.764</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(zip_m2))   <span class="co"># exponentiated coefficients</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##   count_(Intercept)    count_off_campus          count_sexm    zero_(Intercept) 
##           2.1260689           1.5157979           2.7756924           0.5468312 
## zero_first_yearTRUE 
##           3.1154949</code></pre>
</div>
</div>
<p>Our model uses <code>first_year</code> to distinguish drinkers and non-drinkers (“Zero-inflation model coefficients”) and <code>off_campus</code> and <code>sex</code> to help explain the differences in the number of drinks among drinkers (“Count model coefficients”). Again, we could have used the same covariates for the two pieces of a ZIP model, but neither <code>off_campus</code> nor <code>sex</code> proved to be a useful predictor of drinkers vs.&nbsp;non-drinkers after we accounted for first-year status.</p>
<p>We’ll first consider the “Count model coefficients,” which provide information on how the sex and off-campus status of a student who is a drinker are related to the number of drinks reported by that student over a weekend. As we have done with previous Poisson regression models, we exponentiate each coefficient for ease of interpretation. Thus, for those who drink, the average number of drinks for males is <span class="math inline">\(e^{1.0209}\)</span> or 2.76 times the number for females (Z = 5.827, p &lt; 0.001) given that you are comparing people who live in comparable settings, i.e., either both on or both off campus. Among drinkers, the mean number of drinks for students living off campus is <span class="math inline">\(e^{0.4159}=1.52\)</span> times that of students living on campus for those of the same sex (Z = 2.021, p = 0.0433).</p>
<p>The “Zero-inflation model coefficients” refer to separating drinkers from non-drinkers. An important consideration in separating drinkers from non-drinkers may be whether this is their first year, where <code>firstYear</code> is a 0/1 indicator variable.</p>
<p>We have <span class="math display">\[
log(\alpha/(1-\alpha)) =-0.6036+1.1364\textrm{first\_year}
\]</span></p>
<p>However, we are interested in <span class="math inline">\(\alpha\)</span>, the proportion of non-drinkers. Exponentiating the coefficient for the first-year term for this model yields 3.12. Here it is interpreted as the odds (<span class="math inline">\(\frac{\alpha}{1-\alpha}\)</span>) that a first-year student is a non-drinker is 3.12 times the odds that an upper-class student is a non-drinker. Furthermore, with a little algebra (solving the equation with <span class="math inline">\(log(\alpha/(1-\alpha)\)</span>) for <span class="math inline">\(\alpha\)</span>), we have</p>
<p><span class="math display">\[
\hat{\alpha} =
\frac{e^ {-0.6036+1.1364(\textrm{first\_year})}}
{1+e^{
-0.6036+1.1364(\textrm{first\_year})
}
}.
\]</span></p>
<p>The estimated chance that a first-year student is a non-drinker is</p>
<p><span class="math display">\[
\frac{e^{0.533}}{1+e^{0.533}} = 0.630
\]</span> or 63.0%, while for non-first-year students, the estimated probability of being a non-drinker is 0.354. If you have seen logistic regression, you’ll recognize that this transformation is what is used to estimate a probability. More on this in [Chapter 6: Logistic Regression].</p>
</section>
<section id="the-vuong-test-optional" class="level3">
<h3 class="anchored" data-anchor-id="the-vuong-test-optional">The Vuong Test (optional)</h3>
<p>Moving from ordinary Poisson to zero-inflated Poisson has helped us address additional research questions: What proportion of students are non-drinkers, and what factors are associated with whether or not a student is a non-drinker? While a ZIP model seems more faithful to the nature and structure of this data, can we quantitatively show that a zero-inflated Poisson is better than an ordinary Poisson model?</p>
<p>We cannot use the drop-in-deviance test we discussed earlier because these two models are not nested within one another. Vuong <span class="citation" data-cites="Vuong1989">[-@Vuong1989]</span> devised a test to make this comparison for the special case of comparing a zero-inflated model and ordinary regression model. Essentially, the Vuong Test is able to compare predicted probabilities of <strong>non-nested</strong> models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vuong</span>(pois_m1, zip_m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Vuong Non-Nested Hypothesis Test-Statistic: 
## (test-statistic is asymptotically distributed N(0,1) under the
##  null that the models are indistinguishible)
## -------------------------------------------------------------
##               Vuong z-statistic             H_A   p-value
## Raw                   -2.688691 model2 &gt; model1 0.0035866
## AIC-corrected         -2.534095 model2 &gt; model1 0.0056369
## BIC-corrected         -2.352922 model2 &gt; model1 0.0093133</code></pre>
</div>
</div>
<p>Here, we have structured the Vuong Test to compare Model 1: Ordinary Poisson Model to Model 2: Zero-inflation Model. If the two models do not differ, the test statistic for Vuong would be asymptotically standard Normal and the p-value would be relatively large. Here the first line of the output table indicates that the zero-inflation model is better (<span class="math inline">\(Z=-2.69,p=.0036\)</span>). Note that the test depends upon sufficiently large n for the Normal approximation, so since our sample size (n=77) is somewhat small, we need to interpret this result with caution. More research is underway to address statistical issues related to these comparisons.</p>
</section>
<section id="residual-plot" class="level3">
<h3 class="anchored" data-anchor-id="residual-plot">Residual Plot</h3>
<p>Fitted values (<span class="math inline">\(\hat{y}\)</span>) and residuals (<span class="math inline">\(y-\hat{y}\)</span>) can be computed for zero-inflation models and plotted. <a href="#fig-poisRes" class="quarto-xref">Figure&nbsp;17</a> reveals that one observation appears to be extreme (Y=22 drinks during the past weekend). Is this a legitimate observation or was there a transcribing error? Without the original respondents, we cannot settle this question. It might be worthwhile to get a sense of how influential this extreme observation is by removing Y=22 and refitting the model.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-poisRes" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-poisRes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-poisRes-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-poisRes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Residuals by fitted counts for ZIP model.<br>

</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="limitations" class="level3">
<h3 class="anchored" data-anchor-id="limitations">Limitations</h3>
<p>Given that you have progressed this far in your statistical education, the weekend drinking survey question should raise some red flags. What time period constitutes the “weekend”? Will some students be thinking of only Saturday night, while others include Friday night or possibly Sunday evening? What constitutes a drink—a bottle of beer? How many drinks will a respondent report for a bottle of wine? Precise definitions would vastly improve the quality of this data. There is also an issue related to confidentiality. If the data is collected in class, will the teacher be able to identify the respondent? Will respondents worry that a particular response will affect their grade in the class or lead to repercussions on a dry campus?</p>
<p>In addition to these concerns, there are a number of other limitations that should be noted. Following the concern of whether this data represents a random sample of any population (it doesn’t), we also must be concerned with the size of this data set. ZIP models are not appropriate for small samples and this data set is not impressively large.</p>
<p>At times, a mixture of zeros occurs naturally. It may not come about because of neglecting to ask a critical question on a survey, but the information about the subpopulation may simply not be ascertainable. For example, visitors from a state park were asked as they departed how many fish they caught, but those who report 0 could be either non-fishers or fishers who had bad luck. These kinds of circumstances occur often enough that ZIP models are becoming increasingly common.</p>
<p>In other cases, zero counts may not represent a mixture from two subpopulations, but one subpopulation might report 0 by definition, while another subpopulation reports counts of 1 or higher. For example, if our response variable is the number of doctor visits by a person in a single year, we may find that those who never visit the doctor are fundamentally different from those who visit at least once. Those who visit the doctor “clear the hurdle” and we want to model number of visits from those individuals, after first using modeling to separate those who visit from those who don’t. These so-called <strong>hurdle models</strong> are discussed in the next section. </p>
</section>
</section>
<section id="case-study-going-vague" class="level2">
<h2 class="anchored" data-anchor-id="case-study-going-vague">Case Study: Going Vague</h2>
<p>In a 2018 study, <span class="citation" data-cites="Chapp2018">@Chapp2018</span> scraped every issue statement from webpages of candidates for the U.S. House of Representatives, counting the number of issues candidates commented on and scoring the level of ambiguity of each statement. We will focus on the issue counts, and determining which attributes (of both the district as a whole and the candidates themselves) are associated with candidate silence (commenting on 0 issues) and a willingness to comment on a greater number of issues.</p>
<section id="research-questions" class="level3">
<h3 class="anchored" data-anchor-id="research-questions">Research Questions</h3>
<p>Which candidates for U.S. House are more likely to have at least one issue page and to offer statements on a greater number of issues? How are a candidate’s political party, incumbency status, and political beliefs related to their willingness to post stands and ideas on issues? How do the demographics and political beliefs of voters in the candidate’s district impact a candidate’s willingness to engage? How does the interplay between candidate profile and voter profile affect a candidate’s willingness to comment on issues?</p>
</section>
<section id="data-organization-2" class="level3">
<h3 class="anchored" data-anchor-id="data-organization-2">Data Organization</h3>
<p>The data set <code>ambiguity.csv</code> contains the following variables:</p>
<ul>
<li><code>name</code> = candidate name</li>
<li><code>distID</code> = unique identification number for Congressional district</li>
<li><code>ideology</code> = candidate left-right orientation (higher scores indicate further to the right)</li>
<li><code>democrat</code> = 1 if Democrat, 0 if Republican</li>
<li><code>mismatch</code> = disagreement between candidate ideology and district voter ideology (higher scores indicate further from the median voter)</li>
<li><code>incumbent</code> = 1 if incumbent, 0 if not</li>
<li><code>demHeterogeneity</code> = how much voters in a district differ according to race, education, occupation, etc. (higher scores indicate greater differences in demographics)</li>
<li><code>attHeterogeneity</code> = how much voters in a district differ according to political ideology (higher scores indicate greater differences in political ideology)</li>
<li><code>distLean</code> = overall ideological lean in a district (higher scores indicate further to the right)</li>
<li><code>totalIssuePages</code> = number of issues candidates commented on (response)</li>
</ul>
<div class="cell">
<div id="tbl-hurdle1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-hurdle1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Selected variables for the first five observations from the Going Vague case study.
</figcaption>
<div aria-describedby="tbl-hurdle1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 15%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: right;">distID</th>
<th style="text-align: left;">democrat_fct</th>
<th style="text-align: left;">incumbent_fct</th>
<th style="text-align: right;">totalIssuePages</th>
<th style="text-align: right;">ambiguity</th>
<th style="text-align: right;">ideology</th>
<th style="text-align: right;">mismatch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">DUNBAR, FORREST</td>
<td style="text-align: right;">200</td>
<td style="text-align: left;">Democrat</td>
<td style="text-align: left;">Challenger</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.7399</td>
<td style="text-align: right;">-0.6268</td>
<td style="text-align: right;">1.0311203</td>
</tr>
<tr class="even">
<td style="text-align: left;">YOUNG, DONALD E</td>
<td style="text-align: right;">200</td>
<td style="text-align: left;">Republican</td>
<td style="text-align: left;">Incumbent</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.6661</td>
<td style="text-align: right;">0.7771</td>
<td style="text-align: right;">0.3727797</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LEFLORE, BURTON R</td>
<td style="text-align: right;">101</td>
<td style="text-align: left;">Democrat</td>
<td style="text-align: left;">Challenger</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0156</td>
<td style="text-align: right;">0.3514</td>
<td style="text-align: right;">0.1818866</td>
</tr>
<tr class="even">
<td style="text-align: left;">BYRNE, BRADLEY ROBERTS</td>
<td style="text-align: right;">101</td>
<td style="text-align: left;">Republican</td>
<td style="text-align: left;">Incumbent</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.3933</td>
<td style="text-align: right;">1.0819</td>
<td style="text-align: right;">0.5486134</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WRIGHT, ERICK</td>
<td style="text-align: right;">102</td>
<td style="text-align: left;">Democrat</td>
<td style="text-align: left;">Challenger</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.3800</td>
<td style="text-align: right;">-0.0038</td>
<td style="text-align: right;">0.6848035</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="exploratory-data-analysis-2" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis-2">Exploratory Data Analysis</h3>
<p>In <a href="#fig-issue-counts" class="quarto-xref">Figure&nbsp;18</a>, we see that observed total issue pages takes on a Poisson shape, as we might expect with a count variable, except for the large spike at 0. In <a href="#sec-drinking" class="quarto-xref">Section&nbsp;1.11</a>, we handled these excess zeros with a zero-inflated Poisson model, modeling zeros as a mixture of non-drinkers and drinkers who reported zero for the weekend in question. With issue statements, this mixture model makes less sense. Candidates decide either to post issue statements or not. Those who decide to not post any issue statements comprise our zeros, and for those who decide to post issue statements, we can model the number they choose to post. Since those who decide to post issue statements “leap over” the zero category, these models are referred to as <strong>hurdle models</strong>. </p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_segment()`).</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-issue-counts" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-issue-counts-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-issue-counts-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-issue-counts-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: A relative frequency plot showing the proportion of candidates for U.S. House of Representatives in 2014 with a specific number of total issue pages on their website.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Similar to ZIP models, in hurdle models we will simultaneously fit two models based on the same response:</p>
<ul>
<li>a model to determine if a candidate remains silent (posts on no issues) or not (posts on as least one issue), applied to all candidates</li>
<li>a model to determine the number of issues a candidate posts on, applied to only those candidates who post at least one issue statement</li>
</ul>
<p>Thus, our exploratory data analysis should investigate both responses.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-binary-incumbent" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binary-incumbent-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-binary-incumbent-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binary-incumbent-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: Examining a categorical predictor (incumbency status) for the binary portion of a hurdle model for candidate issue statements.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="fig-binary-demHetero" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binary-demHetero-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-binary-demHetero" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-binary-demHetero-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-binary-demHetero-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-binary-demHetero-1.png" class="img-fluid figure-img" data-ref-parent="fig-binary-demHetero" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-binary-demHetero-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Boxplot of district demographic heterogeneity by binary issue page classification
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-binary-demHetero" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-binary-demHetero-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-binary-demHetero-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-binary-demHetero-2.png" class="img-fluid figure-img" data-ref-parent="fig-binary-demHetero" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-binary-demHetero-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Scatterplot of log odds of at least one issue page vs.&nbsp;district heterogeneity in demographics, after creating 25 groups based on heterogeneity score
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binary-demHetero-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20: Examining a continuous predictor (district demographic heterogeneity) for the binary portion of a hurdle model for candidate issue statements.
</figcaption>
</figure>
</div>
<div id="fig-binary-interaction" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binary-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-binary-interaction" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-binary-interaction-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-binary-interaction-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-binary-interaction-1.png" class="img-fluid figure-img" data-ref-parent="fig-binary-interaction" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-binary-interaction-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Boxplots of candidate ideology scores by party and binary issue page classification
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-binary-interaction" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-binary-interaction-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-binary-interaction-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-binary-interaction-2.png" class="img-fluid figure-img" data-ref-parent="fig-binary-interaction" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-binary-interaction-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Scatterplots by party of log odds of at least one issue page vs.&nbsp;candidate ideology, after creating 25 groups based on ideology
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binary-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;21: Examining an interaction term (candidate ideology by party) as a predictor for the binary portion of a hurdle model for candidate issue statements.
</figcaption>
</figure>
</div>
<p><a href="#fig-binary-incumbent" class="quarto-xref">Figure&nbsp;19</a>, <a href="#fig-binary-demHetero" class="quarto-xref">Figure&nbsp;20</a>, and <a href="#fig-binary-interaction" class="quarto-xref">Figure&nbsp;21</a> examine all candidates to determine promising variables to explain our binary response: if a candidate remains silent (posts on no issues) or not (posts on as least one issue). To investigate categorical explanatory variables, we can use segmented bar plots as in <a href="#fig-binary-incumbent" class="quarto-xref">Figure&nbsp;19</a>. Here we see that challengers are more likely to post at least one issue page compared with incumbents. To investigate numeric explanatory variables, we can use boxplots or, better yet, a scatterplot of the log odds that a candidate posts at least one issue page as in <a href="#fig-binary-demHetero" class="quarto-xref">Figure&nbsp;20</a>. Here we see that more heterogeneity in demographics among voters in a district is associated with lower odds of posting at least one issue page. Finally, to investigate the interaction between a categorical and a numeric variable, we can expand the plots in <a href="#fig-binary-demHetero" class="quarto-xref">Figure&nbsp;20</a> by showing separate boxplots or scatterplots for each category as in <a href="#fig-binary-interaction" class="quarto-xref">Figure&nbsp;21</a>. Here we see, especially in the coded scatterplot, that there is evidence of a potential interaction between party and candidate ideology, where candidates whose ideology is further to the extreme in their party are more likely to post at least one issue page.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that hurdle models focus on modeling <em>non-zeros</em>, whereas ZIP models focus on modeling <em>true zeros</em>. This really only affects the interpretation of coefficients from the logistic part of the model.</p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-count-incumbent" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-count-incumbent-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-count-incumbent-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-count-incumbent-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22: Examining a categorical predictor (incumbency status) for the count portion of a hurdle model for candidate issue statements, among candidates with at least one issue page.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="fig-count-demHetero" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-count-demHetero-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-count-demHetero" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-count-demHetero-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-count-demHetero-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-count-demHetero-1.png" class="img-fluid figure-img" data-ref-parent="fig-count-demHetero" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-count-demHetero-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Scatterplot of district demographic heterogeneity vs.&nbsp;number of issue pages, with one point per candidate
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-count-demHetero" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-count-demHetero-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-count-demHetero-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-count-demHetero-2.png" class="img-fluid figure-img" data-ref-parent="fig-count-demHetero" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-count-demHetero-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Scatterplot of log of the mean number of issue pages vs.&nbsp;district heterogeneity in demographics, after creating 25 groups based on heterogeneity score
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-count-demHetero-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23: Examining a continuous predictor (district demographic heterogeneity) for the count portion of a hurdle model for candidate issue statements, among candidates with at least one issue page.
</figcaption>
</figure>
</div>
<div id="fig-count-interaction" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-count-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-count-interaction" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-count-interaction-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-count-interaction-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-count-interaction-1.png" class="img-fluid figure-img" data-ref-parent="fig-count-interaction" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-count-interaction-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Scatterplots by party of candidate ideology score vs.&nbsp;number of issue pages, with one point per candidate
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-count-interaction" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-count-interaction-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-count-interaction-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-Poisson-Regression-new_files/figure-html/fig-count-interaction-2.png" class="img-fluid figure-img" data-ref-parent="fig-count-interaction" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-count-interaction-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Scatterplots by party of log of the mean number of issue pages vs.&nbsp;candidate ideology score, after creating 25 groups based on ideology
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-count-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;24: Examining an interaction term (candidate ideology by party) as a predictor for the count portion of a hurdle model for candidate issue statements, among candidates with at least one issue page.
</figcaption>
</figure>
</div>
<p><a href="#fig-count-incumbent" class="quarto-xref">Figure&nbsp;22</a>, <a href="#fig-count-demHetero" class="quarto-xref">Figure&nbsp;23</a>, and <a href="#fig-count-interaction" class="quarto-xref">Figure&nbsp;24</a> examine candidates with at least one issue page to determine promising variables to explain our count response: the total number of issue pages posted. To investigate categorical explanatory variables, we can use boxplots as in <a href="#fig-count-incumbent" class="quarto-xref">Figure&nbsp;22</a>. Here we see little apparent different between incumbents and challengers with respect to number of issue pages, although challengers have more spread. To investigate numeric explanatory variables, we can use scatterplots with one point per candidate or, better yet, scatterplots of the log mean number of issue pages after grouping candidates by their district heterogeneity scores, as in <a href="#fig-count-demHetero" class="quarto-xref">Figure&nbsp;23</a>. Here we see that more heterogeneity in demographics among voters in a district is associated with lower number of issue pages, on average. Finally, to investigate the interaction between a categorical and a numeric variable, we can expand the plots in <a href="#fig-count-demHetero" class="quarto-xref">Figure&nbsp;23</a> by showing separate scatterplots for each category as in <a href="#fig-count-interaction" class="quarto-xref">Figure&nbsp;24</a>. Here we see evidence of a potential interaction between party and candidate ideology, where candidates whose ideology is further to the extreme in their party likely to post a greater number of issue pages.</p>
</section>
</section>
<section id="hurdle-models" class="level2">
<h2 class="anchored" data-anchor-id="hurdle-models">Hurdle Models</h2>
<section id="fitting-a-hurdle-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-a-hurdle-model">Fitting a Hurdle Model</h3>
<p>Similar to ZIP models (<a href="#sec-ZIPmodel" class="quarto-xref">Section&nbsp;1.12</a>), we will define <span class="math inline">\(\lambda\)</span> to be the mean number of drinks <em>among those who posted at least one issue page</em>, and <span class="math inline">\(\alpha\)</span> to be the proportion of <em>candidates who post at least one issue page</em> (“true non-zeros” or “true hurdlers”). Then, we will attempt to model <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\alpha\)</span> (or functions of <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\alpha\)</span>) simultaneously using characteristics of the candidates and their districts. We can use different predictors if we wish in the two parts of our model. This type of model is referred to as a <strong>hurdle model</strong>. </p>
<p>Once again, the response for the binary part of the model is the log odds of posting at least one issue page, that is <span class="math inline">\(logit(\alpha) = log( \alpha/(1-\alpha))\)</span> where <span class="math inline">\(\alpha\)</span> is the probability of being in the posting group, as described more fully in [Chapter 6: Logistic Regression]. The response for the count part of the model is <span class="math inline">\(log(\lambda)\)</span>, where <span class="math inline">\(\lambda\)</span> is the mean number of issue pages posted <em>among those who choose to post at least one</em>.</p>
<p>One additional difference between a hurdle model and a ZIP model is that, in a hurdle model, the count portion of the model is actually based on a <strong>truncated Poisson</strong> distribution rather than a full Poisson distribution. While a full Poisson distribution has a domain starting at 0, a truncated Poisson distribution has a domain starting at 1. Therefore, while from 3: Distribution Theory we know that a full Poisson distribution has probability mass function</p>
<p><span class="math display">\[
P(Y=y) = \frac{e^{-\lambda}\lambda^y}{y!} \quad \textrm{for} \quad y = 0, 1, \ldots, \infty,
\]</span> a truncated Poisson distribution has probability mass function</p>
<p><span class="math display">\[
P(Y=y) = \frac{e^{-\lambda}\lambda^y}{y!}/[1-e^{-\lambda}] \quad \textrm{for} \quad y = 1, 2, \ldots, \infty.
\]</span> Despite this difference, coefficients in the count portion of a hurdle model are still interpreted in the same way as coefficients in a Poisson model, as multiplicative effects on mean count (after exponentiating).</p>
</section>
<section id="hurdle-models-for-issue-pages" class="level3">
<h3 class="anchored" data-anchor-id="hurdle-models-for-issue-pages">Hurdle Models for Issue Pages</h3>
<p>As expected with our large number of zeros, a regular Poisson model shows a significant lack of fit, so we jump right into fitting hurdle models.</p>
<p>We will focus on interpretations of the hurdle model below. While additional steps could be considered to simplify both portions of our model, the model below matches the “‘Silence’ and Issue Count Model” columns in Table 1 of <span class="citation" data-cites="Chapp2018">@Chapp2018</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>hurdle_model <span class="ot">&lt;-</span> <span class="fu">hurdle</span>(totalIssuePages <span class="sc">~</span> democrat <span class="sc">+</span> incumbent <span class="sc">+</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    demHeterogeneity <span class="sc">+</span> mismatch <span class="sc">+</span> attHeterogeneity <span class="sc">+</span> distLean <span class="sc">+</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    ideology <span class="sc">+</span> ideology<span class="sc">:</span>democrat <span class="sc">|</span> democrat <span class="sc">+</span> incumbent <span class="sc">+</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    demHeterogeneity <span class="sc">+</span> mismatch <span class="sc">+</span> attHeterogeneity <span class="sc">+</span> distLean <span class="sc">+</span> </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    ideology <span class="sc">+</span> ideology<span class="sc">:</span>democrat, </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ambiguity, </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist=</span><span class="st">"poisson"</span>, </span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero=</span><span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>## $count
##                      Estimate Std. Error    z value     Pr(&gt;|z|)
## (Intercept)        2.45103877 0.27047135  9.0621012 1.279614e-19
## democrat           0.07959808 0.04610474  1.7264622 8.426430e-02
## incumbent         -0.15641727 0.03387996 -4.6168076 3.896882e-06
## demHeterogeneity  -1.17320291 0.30777391 -3.8118986 1.379035e-04
## mismatch          -0.24145000 0.05091321 -4.7423839 2.112178e-06
## attHeterogeneity   0.26047088 0.15455577  1.6852873 9.193315e-02
## distLean          -0.01690677 0.05671467 -0.2981022 7.656252e-01
## ideology           0.22218239 0.04942142  4.4956696 6.935136e-06
## democrat:ideology -0.49037897 0.08754552 -5.6014172 2.126064e-08
## 
## $zero
##                      Estimate Std. Error    z value     Pr(&gt;|z|)
## (Intercept)        6.50252289  2.4122716  2.6956015 7.026168e-03
## democrat           0.10514268  0.3644420  0.2885032 7.729616e-01
## incumbent         -1.20851991  0.3217195 -3.7564393 1.723480e-04
## demHeterogeneity  -7.39399676  3.1348297 -2.3586598 1.834106e-02
## mismatch          -1.13047820  0.3103128 -3.6430283 2.694492e-04
## attHeterogeneity   0.51781946  1.1789724  0.4392125 6.605075e-01
## distLean          -0.09105567  0.5224843 -0.1742745 8.616498e-01
## ideology           1.45878121  0.3047631  4.7866067 1.696247e-06
## democrat:ideology -2.40739750  0.4294591 -5.6056502 2.074746e-08</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Log likelihood =  -1995.361</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(hurdle_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 4026.721</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(hurdle_model)  <span class="co"># uses 665 = complete cases</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 4107.718</code></pre>
</div>
</div>
<p>For the “zero” portion of the hurdle model, exponentiated coefficients describe the multiplicative effect of a predictor on the odds of posting at least one issue page. If we consider <code>incumbent</code> as an example, <span class="math inline">\(e^{-1.2085}=0.299\)</span> and <span class="math inline">\(1/e^{-1.2085}=3.35\)</span>. Thus, the odds a challenger posts at least one issue page are 3.35 times greater than the odds an incumbent posts at least one issue page, holding candidate party, ideology, and mismatch, along with district lean, demographic heterogeneity, and attitudinal heterogeneity all constant.</p>
<p>For the “count” portion of the hurdle model, exponentiated coefficients describe the multiplicative effect of a predictor on the mean number of issue pages posted, among those who choose to post at least one issue page. If we consider <code>demHeterogeneity</code> as an example, <span class="math inline">\(e^{-1.173}=0.309\)</span> and <span class="math inline">\(1/e^{-1.173}=3.23\)</span>. Thus, among candidates who choose to post at least one issue page, the mean number of issue pages posted are 3.23 times greater with each one unit decrease in demographic heterogeneity score, holding candidate party, incumbency, ideology, and mismatch, along with district lean and attitudinal heterogeneity all constant.</p>
<p>For an interaction term like <code>democrat:ideology</code>, we note that <span class="math inline">\(1/e^{-0.490}=1.632\)</span> and <span class="math inline">\(1/e^{-0.490+0.222}=1.307\)</span>. Thus, for each 1 unit decrease in ideology (more liberal), the mean number of issue pages (for candidates with at least one issue page) increases by 63.2% for democrats but only 30.7% for republicans.</p>
<p>Looking at our full hurdle model, candidates for U.S. House were more likely to have at least one issue page if they were not an incumbent, if voter demographics were more homogeneous, if their ideology agreed with voter ideology, and if they were a democrat with left-leaning ideology. Of those candidates who had at least one issue page, the same profile marked candidates with a greater average number of issue pages. Most of these model findings agreed with political theory as laid out in <span class="citation" data-cites="Chapp2018">@Chapp2018</span>; candidates are disincentivized to take public stances on issues if they are an incumbent, if their constituents have a wide ranges of backgrounds, and if their beliefs are less aligned with their constituents. Figure 3 in <span class="citation" data-cites="Chapp208">@Chapp208</span> further shows how candidate ideology and party impact individual key issues.</p>
</section>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final Thoughts</h2>
<p>Poisson regression models provide a natural extension to multiple linear regression models which allow analysts to model responses which are counts. Certain violations of Poisson regression model conditions, like overdispersion and uneven sampling effort, are fairly common but can be reasonably handled using ad-hoc adjustments (like quasi-Poisson models) or other distributions (like the negative binomial) with additional model parameters. Other common violations, including those caused by excess zeros, can be addressed through specialized models such as zero-inflated Poisson and hurdle, where multiple models for related responses are fit simultaneously, but model interpretations remain familiar. Here we have only skimmed the surface of Poisson-flavored models, but we want you to be aware of the flexible and creative modeling possibilities for fitting data consistent with its true underlying characteristics. We hope you will see this theme throughout this book!</p>
<p>The next chapter, 5: Generalized Linear Models, provides a theoretical detour that shows how many of these seemingly unrelated models—linear regression, Poisson regression, negative binomial regression, etc.—can fit neatly together in a single unifying theory.</p>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<section id="sec-conc-exer4" class="level3">
<h3 class="anchored" data-anchor-id="sec-conc-exer4">Conceptual Exercises</h3>
<p>Exercises 1-4 involve predicting a <strong>response</strong> using one or more <strong>explanatory variables</strong>, where these examples have response variables that are counts per some unit of time or space. List the response (both what is being counted and over what unit of time or space) and relevant explanatory variables.</p>
<ol type="1">
<li>Are the number of motorcycle deaths in a given year related to a state’s helmet laws?</li>
<li>Does the number of employers conducting on-campus interviews during a year differ for public and private colleges?</li>
<li>Does the daily number of asthma-related visits to an Emergency Room differ depending on air pollution indices?</li>
<li>Has the number of deformed fish in randomly selected Minnesota lakes been affected by changes in trace minerals in the water over the last decade? </li>
<li>Models of the form <span class="math inline">\(Y_i=\beta_0+\beta_1X_i+\epsilon_i, \epsilon_i \sim iidN(0,\sigma)\)</span> are fit using the method of least squares. What method is used to fit Poisson regression models?</li>
<li>What should be done before adjusting for overdispersion?</li>
<li>Why are quasi-Poisson models used, and how do the results typically compare for corresponding models using regular Poisson regression?</li>
<li>Why is the log of mean counts, log(<span class="math inline">\(\bar{Y}\)</span>), not <span class="math inline">\(\bar{Y}\)</span>, plotted against X when assessing the assumptions for Poisson regression?</li>
<li>How can the assumption of <em>mean=variance</em> be checked for Poisson regression? What if there are not many repeated observations at each level of X?</li>
<li>Is it possible that a predictor is significant for a model fit using Poisson regression, but not for a model for the same data fit using quasi-Poisson regression? Explain.</li>
</ol>
<p>Complete (a)-(d) in the context of the study for Exercises 11-13.</p>
<ol type="a">
<li>Define the response.</li>
<li>What are the possible values for the response?</li>
<li>What does <span class="math inline">\(\lambda\)</span> represent?</li>
<li>Would a zero-inflated model be considered here? If so, what would be a “true zero”?</li>
</ol>
<ol start="11" type="1">
<li><p><strong>Fish (or, as they say in French, poisson).</strong> A state wildlife biologist collected data from 250 park visitors as they left at the end of their stay. Each was asked to report the number of fish they caught during their one-week stay. On average, visitors caught 21.5 fish per week.</p></li>
<li><p><strong>Methadone program recidivism.</strong> Program facilitators keep track of the number of times their program’s patients relapse within five years of initial treatment. Data on 100 patients yielded a mean number of 2.8 relapses per patient within the five years of initial treatment.</p></li>
<li><p><strong>Clutch size.</strong> Thirty nests were located and the number of eggs in each nest were counted at the start of a season. Later in the season following a particularly destructive storm, the mean clutch size of the 30 nests was only 1.7 eggs per nest. </p></li>
<li><p><strong>Credit card use.</strong> A survey of 1,000 consumers asked respondents how many credit cards they use. Interest centers on the relationship between credit card use and income, in $10,000. The estimated coefficient for income is 2.1.</p>
<ul>
<li>Identify the predictor and interpret the estimated coefficient for the predictor in this context.</li>
<li>Describe how the assumption of linearity can be assessed in this example.</li>
<li>Suggest a way in which to assess the equal mean and variance assumption.</li>
</ul></li>
</ol>
<div class="cell">
<div id="tbl-tab2chp4" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-tab2chp4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Sample data for Exercise 15.
</figcaption>
<div aria-describedby="tbl-tab2chp4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Age</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Time Online</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Number of Dates Arranged Online</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">29</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">38</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">55</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<ol start="15" type="1">
<li><p><strong>Dating online.</strong> Researchers are interested in the number of dates respondents arranged online and whether the rates differ by age group. Questions which elicit responses similar to this can be found in the Pew Survey concerning dating online and relationships <span class="citation" data-cites="Duggan2013">[@Duggan2013]</span>. Each survey respondent was asked how many dates they have arranged online in the past 3 months as well as the typical amount of time, <span class="math inline">\(t\)</span>, in hours, they spend online weekly. Some rows of data appear in <a href="#tbl-tab2chp4" class="quarto-xref">Table&nbsp;5</a>.</p>
<ul>
<li>Identify the response, predictor, and offset in this context. Does using an offset make sense?</li>
<li>Write out a model for this data. As part of your model description, define the parameter, <span class="math inline">\(\lambda\)</span>.</li>
<li>Consider a zero-inflated Poisson model for this data. Describe what the `true zeros’ would be in this setting.</li>
</ul></li>
</ol>
<div class="cell">
<div id="tbl-tab3chp4" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-tab3chp4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6: Data from Scotto et al.&nbsp;(1974) on the number of cases of non-melanoma skin cancer for women by age group in two metropolitan areas (Minneapolis-St.&nbsp;Paul and Dallas-Ft. Worth); the year is unknown.
</figcaption>
<div aria-describedby="tbl-tab3chp4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Number of Cases</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Population</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Age Group</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">City</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">172675</td>
<td style="text-align: left;">15-24</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">16</td>
<td style="text-align: left;">123065</td>
<td style="text-align: left;">25-34</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
</tr>
<tr class="even">
<td style="text-align: left;">226</td>
<td style="text-align: left;">29007</td>
<td style="text-align: left;">75-84</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">65</td>
<td style="text-align: left;">7538</td>
<td style="text-align: left;">85+</td>
<td style="text-align: left;">2</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0; border: 0;"><sup></sup> The columns contain: number of cases, population size, age group, and city (1=Minneapolis-St. Paul, 2=Dallas-Ft. Worth).</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tfoot>

</table>


</div>
</div>
</figure>
</div>
</div>
<ol start="16" type="1">
<li><p><strong>Poisson approximation: rare events.</strong> For rare diseases, the probability of a case occurring, <span class="math inline">\(p\)</span>, in a very large population, <span class="math inline">\(n\)</span>, is small. With a small <span class="math inline">\(p\)</span> and large <span class="math inline">\(n\)</span>, the random variable <span class="math inline">\(Y\)</span>= the number of cases out of <span class="math inline">\(n\)</span> people can be approximated using a Poisson random variable with <span class="math inline">\(\lambda = np\)</span>. If the count of those with the disease is observed in several different populations independently of one another, the <span class="math inline">\(Y_i\)</span> represents the number of cases in the <span class="math inline">\(i^{th}\)</span> population and can be approximated using a Poisson random variable with <span class="math inline">\(\lambda_i=n_ip_i\)</span> where <span class="math inline">\(p_i\)</span> is the probability of a case for the <span class="math inline">\(i^{th}\)</span> population. Poisson regression can take into account the differences in the population sizes, <span class="math inline">\(n_i\)</span>, using as an offset log(<span class="math inline">\(n_i\)</span>) as well as differences in a population characteristic like <span class="math inline">\(x_i\)</span>. The coefficient of the offset is set at one; it is not estimated like the other coefficients. Thus the model statement has the form: <span class="math inline">\(log(\lambda_i) = \beta_0+\beta_1x_i + log(n_i)\)</span>, where <span class="math inline">\(Y_i  \sim\)</span> Poisson(<span class="math inline">\(\lambda_i = n_i p_i\)</span>). Note that <span class="math inline">\(\lambda_i\)</span> depends on <span class="math inline">\(x_i\)</span> which may differ for the different populations.</p>
<p><span class="citation" data-cites="Scotto1974">@Scotto1974</span> wondered if skin cancer rates by age group differ by city. Based on their data in <a href="#tbl-tab3chp4" class="quarto-xref">Table&nbsp;6</a>, identify and describe the following quantities which appear in the description of the Poisson approximation for rare events:</p>
<ul>
<li>A case,</li>
<li>The population size, <span class="math inline">\(n_i\)</span>,</li>
<li>Probability, <span class="math inline">\(p_i\)</span>,</li>
<li>Poisson parameter, <span class="math inline">\(\lambda_i\)</span>,</li>
<li>Poisson random variables, <span class="math inline">\(Y_i\)</span>, and</li>
<li>The predictors, <span class="math inline">\(X_i\)</span>.</li>
</ul></li>
</ol>
</section>
<section id="guided-exercises" class="level3">
<h3 class="anchored" data-anchor-id="guided-exercises">Guided Exercises</h3>
<ol type="1">
<li><strong>College burglaries.</strong> We wish to build a regression model to describe the number of burglaries on a college campus in a year. Our population of interest will be U.S. liberal arts colleges.
<ol type="a">
<li>Describe why the response variable (<span class="math inline">\(Y\)</span> = # burglaries on campus in a year) could be modeled by a Poisson distribution.</li>
<li>Describe explanatory variables which might explain differences in <span class="math inline">\(\lambda_i\)</span> = mean number of burglaries per year on campus <span class="math inline">\(i\)</span>.</li>
<li>Consider a campus with an average of 5 burglaries per year. Use <code>dpois()</code> to sketch a plot of the distribution of <span class="math inline">\(Y\)</span> for this campus. Use <code>rpois()</code> to verify that both the mean and variance of <span class="math inline">\(Y\)</span> are given by <span class="math inline">\(\lambda=5\)</span>.</li>
<li>Consider a campus with an average of 20 burglaries per year and repeat (c).</li>
</ol></li>
<li><strong>Elephant mating.</strong> How does age affect male elephant mating patterns? An article by <span class="citation" data-cites="Poole1989">@Poole1989</span> investigated whether mating success in male elephants increases with age and whether there is a peak age for mating success. To address this question, the research team followed 41 elephants for one year and recorded both their ages and their number of matings. The data <span class="citation" data-cites="Ramsey2002">[@Ramsey2002]</span> is found in <code>elephant.csv</code>, and the variables are:
<ul>
<li><code>MATINGS</code> = the number of matings in a given year</li>
<li><code>AGE</code> = the age of the elephant in years.</li>
</ul>
<ol type="a">
<li>Create a histogram of MATINGS. Is there preliminary evidence that number of matings could be modeled as a Poisson response? Explain.</li>
<li>Plot MATINGS by AGE. Add a least squares line. Is there evidence that modeling matings using a linear regression with age might not be appropriate? Explain. (Hints: fit a smoother; check residual plots).</li>
<li>For each age, calculate the mean number of matings. Take the log of each mean and plot it by AGE.
<ol type="i">
<li>What assumption can be assessed with this plot?</li>
<li>Is there evidence of a quadratic trend on this plot?</li>
</ol></li>
<li>Fit a Poisson regression model with a linear term for AGE. Exponentiate and then interpret the coefficient for AGE.</li>
<li>Construct a 95% confidence interval for the slope and interpret in context (you may want to exponentiate endpoints).</li>
<li>Are the number of matings significantly related to age? Test with
<ol type="i">
<li>a Wald test and</li>
<li>a drop in deviance test.</li>
</ol></li>
<li>Add a quadratic term in AGE to determine whether there is a maximum age for the number of matings for elephants. Is a quadratic model preferred to a linear model? To investigate this question, use
<ol type="i">
<li>a Wald test and</li>
<li>a drop in deviance test.</li>
</ol></li>
<li>What can we say about the goodness-of-fit of the model with age as the sole predictor? Compare the residual deviance for the linear model to a <span class="math inline">\(\chi^2\)</span> distribution with the residual model degrees of freedom.</li>
<li>Fit the linear model using quasi-Poisson regression. (Why?)
<ol type="i">
<li>How do the estimated coefficients change?</li>
<li>How do the standard errors change?</li>
<li>What is the estimated dispersion parameter?</li>
<li>An estimated dispersion parameter greater than 1 suggests overdispersion. When adjusting for overdispersion, are you more or less likely to obtain a significant result when testing coefficients? Why?</li>
</ol></li>
</ol></li>
</ol>
<div class="cell">
<div id="tbl-ex3chp4" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ex3chp4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7: A small subset of hypothetical data on Minnesota workplace rules on smoking.
</figcaption>
<div aria-describedby="tbl-ex3chp4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Subject</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">X (location)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Y (cigarettes)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: right; padding: 0; border: 0;"><sup></sup> X is 0 for home and 1 for work.</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: right; padding: 0; border: 0;"><sup></sup> Y is number of cigaretttes in a 2-hour period.</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tfoot>

</table>


</div>
</div>
</figure>
</div>
</div>
<ol start="3" type="1">
<li><p><strong>Smoking at work and home.</strong> An earlier study examined the effect of workplace rules in Minnesota which require smokers to smoke cigarettes outside. The number of cigarettes smoked by smokers in a 2-hour period was recorded, along with whether the smoker was at home or at work. A (very) small subset of the data appears in <a href="#tbl-ex3chp4" class="quarto-xref">Table&nbsp;7</a>.</p>
<ul>
<li>Model 1: Assume that <span class="math inline">\(Y \sim \textrm{Poisson}(\lambda)\)</span>; there is no difference between home and work.</li>
<li>Model 2: Assume that <span class="math inline">\(Y \sim \textrm{Poisson}(\lambda_W)\)</span> when the smoker is at work, and <span class="math inline">\(Y \sim \textrm{Poisson}(\lambda_H)\)</span> when the smoker is at home.</li>
<li>Model 3: Assume that <span class="math inline">\(Y \sim \textrm{Poisson}(\lambda)\)</span> and <span class="math inline">\(log(\lambda)=\beta_0+\beta_1X\)</span>.</li>
</ul>
<ol type="a">
<li>Write out the likelihood <span class="math inline">\(L(\lambda)\)</span> and the log-likelihood <span class="math inline">\(logL(\lambda)\)</span> in Model 1. Use the data values above, and simplify where possible.</li>
<li>Intuitively, what would be a reasonable estimate for <span class="math inline">\(\lambda\)</span> based on this data? Why?</li>
<li>Find the maximum likelihood estimator for <span class="math inline">\(\lambda\)</span> in Model 1 using an optimization routine in R (but not the <code>glm()</code> function). Use R to produce a plot of the likelihood function <span class="math inline">\(L(\lambda)\)</span>.</li>
<li>Write out the log-likelihood function <span class="math inline">\(logL(\lambda_W, \lambda_H)\)</span> in Model 2. Use the data values above, and simplify where possible.</li>
<li>Intuitively, what would be reasonable estimates for <span class="math inline">\(\lambda_W\)</span> and <span class="math inline">\(\lambda_H\)</span> based on this data? Why?</li>
<li>Find the maximum likelihood estimators for <span class="math inline">\(\lambda_W\)</span> and <span class="math inline">\(\lambda_H\)</span> in Model 2 using an optimization routine in R (but not the <code>glm()</code> function).</li>
</ol></li>
<li><p><strong>Smoking at work and home (continued).</strong> We will use the same data set in this question as we used in Question 3.</p>
<ol type="a">
<li>Write out the log-likelihood function <span class="math inline">\(logL(\beta_0, \beta_1)\)</span> in Model 3. Again, use the data values above, and simplify where possible.</li>
<li>Find the maximum likelihood estimators for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> in Model 3 using an optimization routine in R (but not the <code>glm()</code> function). Use R to produce a 3D plot of the log-likelihood function.</li>
<li>Confirm your estimates for Model 1 and Model 3 using <code>glm()</code>. Then show that the MLEs for Model 3 agree with the MLEs for Model 2.</li>
</ol>
<p>For the remaining questions, we will focus exclusively on Model 3.</p>
<ol start="4" type="a">
<li>State a (one-sided) hypothesis for <span class="math inline">\(\beta_1\)</span> in the context of the problem (i.e., explain how your hypothesis relates to smoking at home and at work). Note: we will nevertheless use two-sided tests and intervals in the following questions.</li>
<li>Do we need to include an offset in our Poisson regression model? Why or why not?</li>
<li>Give estimates of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>, and provide interpretations for both in the context of the problem.</li>
<li>Provide and interpret a 95% confidence interval for <span class="math inline">\(\beta_1\)</span>.</li>
<li>Provide two <em>different</em> significance tests for <span class="math inline">\(\beta_1\)</span>, in each case providing a test statistic and a p-value and a conclusion in the context of the problem.</li>
<li>Provide a goodness-of-fit test for Model 3, again providing a test statistic, p-value, and conclusion in context.</li>
<li>Can we generalize results of this study to all Minnesota smokers? Why or why not?</li>
<li>Can we claim that rules restricting smoking in the workplace have caused lower levels of smoking at work? Explain.</li>
<li>Give two ways in which this study might be improved (besides simply “bigger sample size”).</li>
</ol></li>
<li><p><strong>Campus crime.</strong> The data set <code>campuscrime09.csv</code> contains the number of burglaries reported at a collection of 47 U.S. public universities with over 10,000 students in the year 2009. In addition, covariates are included which may explain differences in crime rates, including total number of students, percentage of men, average SAT and ACT test scores, and tuition.</p>
<ol type="a">
<li>Perform an exploratory data analysis. Support your analysis with plots and summary statistics.
<ol type="i">
<li>Analyze whether number of burglaries could be reasonably modeled with a Poisson distribution.</li>
<li>Analyze which covariates you expect to be the best predictors of burglaries.</li>
</ol></li>
<li>Consider a model with 4 predictors: <code>act.comp + tuition + pct.male + total</code>. Try fitting a linear regression with <code>burg09</code> as the response. Are there any concerns with this linear regression model?</li>
<li>Run a Poisson regression model with the 4 predictors from (b). Interpret the coefficients for <code>tuition</code> and <code>pct.male</code>.</li>
<li>Replace <code>tuition</code> with tuition in thousands in your model from (c) – i.e., <code>tuition.thous</code>=<code>tuition</code>/1000. How does your new model compare to your model in (c)? Interpret the coefficient for <code>tuition.thous</code>.</li>
<li>We will consider the possibility of including the total number of students at a university as an offset.
<ol type="i">
<li>Explain why we might consider <code>total</code> as an offset.</li>
<li>Refit your model from (d) with total (actually, log(total)) as an offset rather than as a predictor. Does this new model appear to fit better or worse than the model from (d)?</li>
<li>Refit your model from (d) with log(total) rather than total – so log(total) is a predictor and not an offset. If total were a good candidate for an offset, what would we expect the coefficient of log(total) to be? Does a 95% confidence interval for that coefficient contain the value you expected?</li>
</ol></li>
<li>Run the following model, then interpret the coefficients for <code>tuition.thous</code> and the interaction between <code>tuition.thous</code> and <code>act.comp</code>.</li>
</ol></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>crime <span class="ot">&lt;-</span> <span class="fu">mutate</span>(crime, <span class="at">total.thous =</span> total<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(burg09 <span class="sc">~</span> act.comp <span class="sc">+</span> tuition.thous <span class="sc">+</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>              total.thous <span class="sc">+</span> act.comp<span class="sc">:</span>tuition.thous <span class="sc">+</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>              act.comp<span class="sc">:</span>total.thous, </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> poisson, </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> crime)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="6" type="1">
<li><strong>Women’s World Cup.</strong> The website FiveThirtyEight created a series of models and predictions for the 2019 Women’s World Cup soccer tournament described in <a href="https://fivethirtyeight.com/features/how-our-2019-womens-world-cup-predictions-work/">this article</a>. Our data set <code>wwc_games.csv</code> was adapted from the <code>wwc_2019_matches</code> data available from the <code>fivethirtyeight</code> R package. Our goal is to investigate whether the Soccer Power Index (spi) is useful for predicting the number of goals a team scores in a game.</li>
</ol>
<p>Key variables include:</p>
<pre><code>- team
- score = number of goals scored
- spi = soccer power index (higher indicates a better team)

where each game is represented by two rows---one for each team playing in the game---and each team appears at least 3 times.

a. Create a histogram of `score`, our response variable, and also a scatterplot with fitted line of `score` vs. `spi`, our primary explanatory variable.  Do you notice anything that may be problematic?
b. Create a graph of mean vs variance with a blue and black line, after first grouping rows by `spi` value.  What does this suggest to you about the appropriateness of a Poisson regression model?
c. Fit a regression model with `spi` as the explanatory variable and `score` as the response. Interpret a 95% confidence interval on the slope for `spi`. 
d. Examine the summary output for this model.  Does there appear to be evidence of overdispersion (or other lack of fit)?  If so, conduct a formal test for goodness of fit.
e. Plot the fitted values vs residuals. Do you see any outliers or evidence of non-linearity?
f. What are some suggestions for further modeling? Try a few possibilities.
g. Give at least one reason why it may not be appropriate to assume the observations are independent in this dataset.</code></pre>
<ol start="7" type="1">
<li><p><strong>U.S. National Medical Expenditure Survey.</strong> The data set <code>NMES1988</code> in the <code>AER</code> package contains a sample of individuals over 65 who are covered by Medicare in order to assess the demand for health care through physician office visits, outpatient visits, ER visits, hospital stays, etc. The data can be accessed by installing and loading the <code>AER</code> package and then running <code>data(NMES1988)</code>. More background information and references about the <code>NMES1988</code> data can be found in help pages for the <code>AER</code> package.</p>
<ol type="a">
<li>Consider the following list of explanatory variables: <code>health</code>, <code>chronic</code>, <code>adl</code>, and <code>income</code>, along with the response variable of <code>visits</code> (number of physician office visits). Perform an EDA to determine which explanatory variables might be related to <code>visits</code>.</li>
<li>Is there evidence of overdispersion in <code>visits1</code> below? How do you know?</li>
<li>Create a plot of mean vs variance. For this example, where there are multiple explanatory variables, you can do your grouping based on the predicted values (see code below). What can you learn from this plot?</li>
<li>Fit both a quasipoisson and a negative binomial model. Compare the coefficient estimates and standard errors. Which model would be more appropriate, based on your results from (c)?</li>
<li>A different group of researchers proposes model <code>visits2</code> instead, and creates the associated mean vs variance plot (see code below). Which type of overdispersed model seems more appropriate for <code>visits2</code>: quasipoisson or negative binomial?</li>
<li>Fit both a quasipoisson and a negative binomial model with the predictors in <code>visits2</code>. Compare the coefficient estimates and standard errors.</li>
<li>Which model is preferred: <code>visits1</code> or <code>visits2</code>?</li>
</ol></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AER)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(NMES1988)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>visits1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(visits <span class="sc">~</span> health <span class="sc">+</span> chronic <span class="sc">+</span> adl <span class="sc">+</span> income, </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> poisson,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> NMES1988)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(visits1)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="co"># mean-variance plot for part (c)</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>NMES1988 <span class="sc">|&gt;</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">predict</span>(visits1),  </span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">grouping =</span> <span class="fu">cut_number</span>(pred, <span class="dv">15</span>)) <span class="sc">|&gt;</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(grouping) <span class="sc">|&gt;</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(visits),</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">Var =</span> <span class="fu">var</span>(visits )) <span class="sc">|&gt;</span> </span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Mean, Var)) <span class="sc">+</span> </span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>visits2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">formula =</span> visits <span class="sc">~</span> insurance <span class="sc">+</span> health <span class="sc">+</span> chronic <span class="sc">+</span> </span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>                 afam <span class="sc">+</span> school <span class="sc">+</span> age, </span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson, </span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> NMES1988)</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(visits2)</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a><span class="co"># mean-variance plot for part (e)</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>NMES1988 <span class="sc">|&gt;</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">predict</span>(visits2), </span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="fu">cut_number</span>(pred, <span class="dv">25</span>)) <span class="sc">|&gt;</span></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">|&gt;</span></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_visits =</span> <span class="fu">mean</span>(visits), </span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">var_visits =</span> <span class="fu">var</span>(visits)) <span class="sc">|&gt;</span></span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(mean_visits, var_visits)) <span class="sc">+</span> </span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">span =</span> <span class="dv">2</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="8" type="1">
<li><p><strong>U.S. National Medical Expenditure Survey (continued).</strong></p>
<ol type="a">
<li>Show through graphical means that there are more respondents with 0 <code>visits</code> than might be expected under a Poisson model.</li>
<li>Fit a ZIP model for the number of physician office <code>visits</code> using <code>chronic</code>, <code>health</code>, and <code>insurance</code> as predictors for the Poisson count, and <code>chronic</code> and <code>insurance</code> as the predictors for the binary part of the model. Then, provide interpretations in context for the following model parameters:</li>
</ol>
<ul>
<li><code>chronic</code> in the Poisson part of the model</li>
<li>poor <code>health</code> in the Poisson part of the model</li>
<li>the Intercept in the logistic part of the model</li>
<li><code>insurance</code> in the logistic part of the model</li>
</ul>
<ol start="3" type="a">
<li>Is there significant evidence that the ZIP model is an improvement over a simple Poisson regression model?</li>
</ol></li>
<li><p><strong>Household size in the Philippines.</strong> This is a continuation of the case study in <a href="#sec-philippines" class="quarto-xref">Section&nbsp;1.4</a>.</p>
<ol type="a">
<li>Conduct a test of significance to compare the models suggested by <a href="#fig-ageXnhouse" class="quarto-xref">Figure&nbsp;6</a> and <a href="#fig-byregion" class="quarto-xref">Figure&nbsp;7</a>; that is, does the quadratic effect of age on household size differ by location? Use Poisson regression models without adjustment for overdispersion.</li>
<li>Assuming you found significance in (a), explain how you would interpret the age-by-location interaction in context. (Hint: describe how the age of maximum household size differs for a couple of locations.)</li>
<li>Repeat (a) using an indicator variable for the Visayas region rather than a 5-level categorical variable for location.</li>
<li>Repeat (a) using a quasi-Poisson model.</li>
<li>Repeat (a) using a negative binomial model.</li>
</ol></li>
</ol>
</section>
<section id="open-ended-exercises" class="level3">
<h3 class="anchored" data-anchor-id="open-ended-exercises">Open-Ended Exercises</h3>
<ol type="1">
<li><p><strong>Airbnb in NYC.</strong> <span class="citation" data-cites="Awad2017">@Awad2017</span> scraped 40628 Airbnb listings from New York City in March 2017 and put together the data set <code>NYCairbnb.csv</code>. Key variables include:</p>
<ul>
<li><code>id</code> = unique ID number for each unit</li>
<li><code>last_scraped</code> = date when information scraped</li>
<li><code>host_since</code> = date when host first listed the unit on Airbnb</li>
<li><code>days</code> = <code>last_scraped</code> - <code>host_since</code> = number of days the unit has been listed</li>
<li><code>room_type</code> = Entire home/apt., Private room, or Shared room</li>
<li><code>bathrooms</code> = number of bathrooms</li>
<li><code>bedrooms</code> = number of bedrooms</li>
<li><code>price</code> = price per night (dollars)</li>
<li><code>number_of_reviews</code> = number of reviews for the unit on Airbnb</li>
<li><code>review_scores_cleanliness</code> = cleanliness score from reviews (1-10)</li>
<li><code>review_scores_location</code> = location score from reviews (1-10)</li>
<li><code>review_scores_value</code> = value score from reviews (1-10)</li>
<li><code>instant_bookable</code> = “t” if instantly bookable, “f” if not</li>
</ul>
<p>Perform an EDA, build a model, and interpret model coefficients to describe variation in the number of reviews (a proxy for the number of rentals, which is not available) as a function of the variables provided. A few hints and notes:</p>
<ul>
<li>Don’t forget to consider an offset, if needed.</li>
<li>You might consider taking a random sample (say of size 1000) for ease in plots and calculations.</li>
<li>You should deliberately decide if you plan to use the review scores in your models; they differ from other variables in that they aren’t fully controlled by the owner, plus they have many missing values.</li>
<li>You might also consider a hurdle model or a ZIP model. Be sure to provide an intuitive explanation before using one of these models.</li>
</ul></li>
<li><p><strong>Crab satellites.</strong> <span class="citation" data-cites="Brockmann1996">@Brockmann1996</span> carried out a study of nesting female horseshoe crabs. Female horseshoe crabs often have male crabs attached to a female’s nest known as <em>satellites</em>. One objective of the study was to determine which characteristics of the female were associated with the number of satellites. Of particular interest is the relationship between the width of the female carapace and satellites.</p>
<p>The data can be found in <code>crab.csv</code>. It includes:</p>
<ul>
<li><code>NumSat</code> = number of satellites</li>
<li><code>Width</code> = carapace width (cm)</li>
<li><code>Wt</code> = weight (kg)</li>
<li><code>Sp</code> = spine condition (1 = both good, 2 = one worn or broken, 3 = both worn or broken)</li>
<li><code>C</code> = color (1 = light medium, 2 = medium, 3 = dark medium, 4 = dark)</li>
</ul>
<p>Use Poisson regression to investigate the research question. Be sure you work to obtain an appropriate model before considering overdispersion. Should a hurdle model be considered here? If so, fit a hurdle model and interpret in context.</p></li>
<li><p><strong>Doctor visits.</strong> Data was collected on doctor visits from a sample of 5,190 people in the 1977/1978 Australian Health Survey. <span class="citation" data-cites="Cameron1986">@Cameron1986</span> sought to explain the variation in doctor visits using one or more explanatory variables. The data can be found in an R data set from <code>library(AER)</code> accessible with the command <code>data("DoctorVisits")</code>. Variable descriptions can be found under <code>help("DoctorVisits")</code>.</p>
<p>Explore the use of a zero-inflated model for this data. Begin with a histogram of the number of visits, complete an EDA, and then fit several models. Summarize your results.</p></li>
<li><p><strong>More fish.</strong> The number of fish caught (<code>count</code>), persons in the party (<code>persons</code>), the number of children in the party (<code>child</code>), whether or not they brought a camper into the park (<code>camper</code>), and the length of stay (<code>LOS</code>) were recorded for 250 camping parties. The data can be found in <code>fish2.csv</code> (source: <span class="citation" data-cites="idre2018">@idre2018</span>). Create and assess a model for the number of fish caught.</p></li>
<li><p><strong>U.S. National Medical Expenditure Survey.</strong> See Guided Exercises (4) and (5) for a description of this data. Beginning with a thorough EDA, build and interpret a model for <code>hospital</code>, the number of hospital stays for a subject during 1988.</p></li>
<li><p><strong>Household size in the Philippines.</strong> This is a continuation of the case study in <a href="#sec-philippines" class="quarto-xref">Section&nbsp;1.4</a>. Instead of total number of household residents, we will focus on modeling the number of household residents below the age of 5 (<code>numLT5</code>). Beginning with a thorough EDA, build and interpret a model for <code>numLT5</code>.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>fHH1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/philippines.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">location =</span> <span class="fu">as_factor</span>(location),</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">roof =</span> <span class="fu">as_factor</span>(roof),</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">age2 =</span> age <span class="sc">*</span> age,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">visayas =</span> <span class="fu">ifelse</span>(location <span class="sc">==</span> <span class="st">"Visayas"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">light_roof =</span> </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(roof <span class="sc">==</span> <span class="st">"Predominantly Light/Salvaged Material"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">...1</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>